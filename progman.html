<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Program Manager</title><style>@import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600&display=swap');body, html { height: 100%; margin: 0; padding: 0; font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; background-color: #f3f3f3; overflow: hidden; color: #000000; font-size: 14px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;}.program-manager { width: 100%; height: 100%; display: flex; flex-direction: column; background-image: url('https://windows11.now.sh/img/backgrounds/default.jpg'); background-size: cover; background-position: center;}.menu-bar { background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 10px; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10000; position: relative; flex-wrap: wrap; justify-content: space-between;}.menu-item { padding: 8px 12px; cursor: pointer; position: relative; border-radius: 4px; transition: background-color 0.2s, color 0.2s; font-weight: 500; color: #1a1a1a; margin: 2px; display: flex; align-items: center; gap: 5px;}.menu-item:hover { background-color: rgba(255, 255, 255, 0.6); color: #0078d4;}.menu-content { display: none; position: absolute; background-color: #ffffff; min-width: 180px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1); z-index: 10001; left: 0; top: 100%; border-radius: 8px; overflow: hidden;}.menu-content a { color: #1a1a1a; padding: 12px 16px; text-decoration: none; display: block; transition: background-color 0.2s, color 0.2s; font-weight: 400;}.menu-content a:hover { background-color: rgba(0, 120, 212, 0.1); color: #0078d4;}.content { flex-grow: 1; display: flex; flex-wrap: wrap; align-content: flex-start; padding: 20px; overflow-y: auto; position: relative; z-index: 1; justify-content: center;}.view-icons .shortcut { width: 80px; height: 90px; margin: 10px; text-align: center; cursor: pointer; user-select: none; transition: transform 0.2s, background-color 0.2s; border-radius: 8px; padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center;}.view-icons .shortcut:hover { background-color: rgba(255, 255, 255, 0.2); transform: scale(1.05);}.view-icons .shortcut img { width: 48px; height: 48px; margin-bottom: 5px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));}.view-icons .shortcut-name { font-size: 12px; word-wrap: break-word; color: #000000; text-shadow: 0 1px 2px rgba(255,255,255,0.7); font-weight: 500; text-align: center;}.view-small-icons .shortcut { width: 60px; height: 70px; margin: 8px; text-align: center; cursor: pointer; user-select: none; transition: transform 0.2s, background-color 0.2s; border-radius: 6px; padding: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center;}.view-small-icons .shortcut:hover { background-color: rgba(255, 255, 255, 0.2); transform: scale(1.05);}.view-small-icons .shortcut img { width: 32px; height: 32px; margin-bottom: 3px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));}.view-small-icons .shortcut-name { font-size: 10px; word-wrap: break-word; color: #000000; text-shadow: 0 1px 2px rgba(255,255,255,0.7); font-weight: 500; text-align: center;}.view-list .shortcut { width: 100%; height: auto; margin: 2px 0; text-align: left; cursor: pointer; user-select: none; transition: background-color 0.2s; border-radius: 4px; padding: 8px 12px; display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.1);}.view-list .shortcut:hover { background-color: rgba(0, 120, 212, 0.1);}.view-list .shortcut img { width: 16px; height: 16px; margin-right: 8px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); display: none;}.view-list .shortcut-name { font-size: 14px; color: #000000; font-weight: 500; flex: 1;}.view-dates .shortcut { width: 100%; height: auto; margin: 2px 0; text-align: left; cursor: pointer; user-select: none; transition: background-color 0.2s; border-radius: 4px; padding: 8px 12px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.1);}.view-dates .shortcut:hover { background-color: rgba(0, 120, 212, 0.1);}.view-dates .shortcut img { width: 16px; height: 16px; margin-right: 8px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));}.view-dates .shortcut-name { font-size: 14px; color: #000000; font-weight: 500; flex: 1;}.view-dates .shortcut-date { font-size: 12px; color: #666; font-style: italic;}.modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); backdrop-filter: blur(5px);}.modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 500px; box-shadow: 0 4px 20px 0 rgba(0,0,0,0.1); border-radius: 10px;}.close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.2s;}.close:hover,.close:focus { color: #000000;}#frame-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); display: none; z-index: 2000;}#frame-container iframe { width: 100%; height: calc(100% - 40px); border: none;}#close-frame { position: absolute; top: 10px; right: 10px; background-color: rgba(255, 255, 255, 0.8); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; line-height: 40px; text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); transition: background-color 0.2s;}#close-frame:hover { background-color: #ffffff;}input[type="text"], input[type="file"], input[type="url"], select, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; font-size: 14px;}button { background-color: #0078d4; color: white; border: none; cursor: pointer; transition: background-color 0.2s; font-weight: 500;}button:hover { background-color: #106ebe;}h2 { font-weight: 600; color: #1a1a1a; margin-bottom: 20px;}.wizard-step { display: none;}.wizard-step.active { display: block;}.wizard-buttons { display: flex; justify-content: space-between; margin-top: 20px;}.wizard-buttons button { width: auto; padding: 10px 20px;}.warning { color: #ff9800; font-style: italic; margin-top: 5px;}.url-type-selector { display: flex; margin-bottom: 10px; border-radius: 4px; overflow: hidden; border: 1px solid #ddd;}.url-type-selector button { flex: 1; background-color: #f5f5f5; color: #333; border: none; padding: 8px; cursor: pointer; transition: background-color 0.2s;}.url-type-selector button.active { background-color: #0078d4; color: white;}.url-type-selector button:not(.active):hover { background-color: #e5e5e5;}.folder-window { position: absolute; background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 10px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2); display: none; flex-direction: column; z-index: 100; min-width: 400px; min-height: 300px; resize: both; overflow: hidden;}.folder-header { background-color: rgba(255, 255, 255, 0.9); padding: 12px 16px; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none; border-bottom: 1px solid rgba(0, 0, 0, 0.1);}.folder-title { font-weight: 600; color: #1a1a1a; display: flex; align-items: center; gap: 8px;}.folder-actions { display: flex; gap: 8px;}.folder-action-btn { background: none; border: none; width: 28px; height: 28px; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background-color 0.2s; color: #1a1a1a; font-family: 'Segoe UI', sans-serif; font-size: 12px; font-weight: 600;}.folder-action-btn:hover { background-color: rgba(0, 0, 0, 0.1);}.folder-action-btn.close-btn:hover { background-color: #e81123; color: white;}.folder-action-btn.minimize-btn::after { content: "‚àí";}.folder-action-btn.maximize-btn::after { content: "‚ñ°";}.folder-action-btn.close-btn::after { content: "√ó";}.window-maximized { position: fixed !important; top: 50px !important; left: 0 !important; width: 100% !important; height: calc(100% - 50px) !important; max-width: 100% !important; max-height: calc(100% - 50px) !important; resize: none !important; border-radius: 0 !important;}.window-minimized { display: none !important;}.folder-scroll-container { flex: 1; position: relative; overflow: hidden; background-color: rgba(255, 255, 255, 0.8);}.folder-scroll-area { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: auto; padding: 8px;}.folder-scroll-area::-webkit-scrollbar { width: 16px; height: 16px;}.folder-scroll-area::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 8px;}.folder-scroll-area::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.2); border-radius: 8px; border: 3px solid transparent; background-clip: content-box;}.folder-scroll-area::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.3); background-clip: content-box;}.folder-scroll-area::-webkit-scrollbar-corner { background: rgba(0, 0, 0, 0.05);}.folder-icons-container { display: flex; flex-wrap: wrap; align-content: flex-start; gap: 8px; min-width: min-content; min-height: min-content; padding: 4px;}.folder-view-icons .folder-shortcut { width: 70px; height: 80px; text-align: center; cursor: pointer; user-select: none; transition: transform 0.2s, background-color 0.2s; border-radius: 6px; padding: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; flex-shrink: 0;}.folder-view-icons .folder-shortcut:hover { background-color: rgba(0, 120, 212, 0.1); transform: scale(1.05);}.folder-view-icons .folder-shortcut img { width: 40px; height: 40px; margin-bottom: 4px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));}.folder-view-icons .folder-shortcut-name { font-size: 11px; word-wrap: break-word; color: #000000; font-weight: 500; text-align: center; line-height: 1.2;}.folder-view-small-icons .folder-shortcut { width: 50px; height: 60px; text-align: center; cursor: pointer; user-select: none; transition: transform 0.2s, background-color 0.2s; border-radius: 4px; padding: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; flex-shrink: 0;}.folder-view-small-icons .folder-shortcut:hover { background-color: rgba(0, 120, 212, 0.1); transform: scale(1.05);}.folder-view-small-icons .folder-shortcut img { width: 24px; height: 24px; margin-bottom: 2px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));}.folder-view-small-icons .folder-shortcut-name { font-size: 9px; word-wrap: break-word; color: #000000; font-weight: 500; text-align: center; line-height: 1.2;}.folder-view-list .folder-shortcut { width: calc(100% - 16px); height: auto; margin: 1px 8px; text-align: left; cursor: pointer; user-select: none; transition: background-color 0.2s; border-radius: 3px; padding: 6px 8px; display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); flex-shrink: 0;}.folder-view-list .folder-shortcut:hover { background-color: rgba(0, 120, 212, 0.1);}.folder-view-list .folder-shortcut img { width: 14px; height: 14px; margin-right: 6px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1)); display: none;}.folder-view-list .folder-shortcut-name { font-size: 12px; color: #000000; font-weight: 500; flex: 1;}.folder-view-dates .folder-shortcut { width: calc(100% - 16px); height: auto; margin: 1px 8px; text-align: left; cursor: pointer; user-select: none; transition: background-color 0.2s; border-radius: 3px; padding: 6px 8px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.05); flex-shrink: 0;}.folder-view-dates .folder-shortcut:hover { background-color: rgba(0, 120, 212, 0.1);}.folder-view-dates .folder-shortcut img { width: 14px; height: 14px; margin-right: 6px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));}.folder-view-dates .folder-shortcut-name { font-size: 12px; color: #000000; font-weight: 500; flex: 1;}.folder-view-dates .folder-shortcut-date { font-size: 10px; color: #666; font-style: italic;}.folder-empty { width: 100%; text-align: center; color: #666; font-style: italic; padding: 40px 0; flex-shrink: 0;}.folder-item-count { font-size: 12px; color: #666; margin-left: 8px; font-weight: normal;}.trash-full { animation: shake 0.5s ease-in-out;}@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); }}.dragging { opacity: 0.5;}.confirm-modal .modal-content { max-width: 400px;}.confirm-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;}.confirm-buttons button { width: auto; min-width: 80px;}.confirm-buttons .cancel-btn { background-color: #6c757d;}.confirm-buttons .cancel-btn:hover { background-color: #5a6268;}.shortcut.selected, .folder-shortcut.selected { background-color: rgba(0, 120, 212, 0.2) !important; border: 2px solid #0078d4 !important;}.shortcut.selected:hover, .folder-shortcut.selected:hover { background-color: rgba(0, 120, 212, 0.3) !important;}::-webkit-scrollbar { width: 10px;}::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 5px;}::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.2); border-radius: 5px;}::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.3);}.help-content { padding: 20px; color: #1a1a1a; max-width: 100%; font-family: 'Segoe UI', sans-serif;}.help-header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #e1e1e1; padding-bottom: 15px;}.help-header h1 { font-size: 24px; font-weight: 600; margin: 0 0 5px 0; color: #0078d4;}.version-info { font-size: 12px; color: #666; font-style: italic; margin: 0;}.help-section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #f0f0f0;}.help-section h2 { font-size: 18px; font-weight: 600; margin: 0 0 10px 0; color: #323130;}.help-section h3 { font-size: 16px; font-weight: 600; margin: 15px 0 8px 0; color: #323130;}.help-section p { margin: 0 0 10px 0; font-size: 14px; line-height: 1.5;}.help-section ul, .help-section ol { margin: 8px 0; padding-left: 20px;}.help-section li { margin-bottom: 5px; font-size: 14px; line-height: 1.4;}.help-section strong { font-weight: 600; color: #0078d4;}.warning-text { background-color: #fff4ce; padding: 10px; border-radius: 4px; border-left: 4px solid #ffb900; font-size: 13px;}.help-footer { margin-top: 30px; padding-top: 15px; border-top: 1px solid #e1e1e1; text-align: center; font-size: 12px; color: #666;}.help-footer p { margin: 5px 0;}.menu-item svg { stroke: #0078d4;}.menu-item.help-menu-item { padding: 8px 15px !important; min-width: 60px; justify-content: center; margin-left: 0; }.menu-item.help-menu-item svg { width: 20px; height: 20px;}.app-window { min-width: 400px; min-height: 300px;}.app-window iframe { width: 100%; height: 100%; border: none; background: white;}.folder-scroll-area::-webkit-scrollbar { width: 12px; height: 12px;}.folder-scroll-area::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 6px;}.folder-scroll-area::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.2); border-radius: 6px; border: 3px solid transparent; background-clip: content-box;}.folder-scroll-area::-webkit-scrollbar-thumb:hover { background: rgba(0, 0, 0, 0.3); background-clip: content-box;}.app-window .folder-header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(0, 0, 0, 0.1);}.app-window .folder-scroll-container { background: white;}.window-active { box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3) !important; z-index: 1000 !important;}.app-window { transition: height 0.3s ease, width 0.3s ease;}.folder-scroll-container { transition: opacity 0.3s ease;}.clock-display { padding: 8px 8px; font-weight: bold; color: #1a1a1a; cursor: pointer; border-radius: 4px; transition: background-color 0.2s; margin: 2px 0; font-size: 13px; min-width: 100px; text-align: center; margin-left: 0; }.clock-display:hover { background-color: rgba(255, 255, 255, 0.6);}.app-selector { padding: 8px 8px; cursor: pointer; position: relative; border-radius: 4px; transition: background-color 0.2s; margin: 2px 0; display: flex; align-items: center; gap: 5px; min-width: 30px; justify-content: center; margin-left: 0; }.app-selector:hover { background-color: rgba(255, 255, 255, 0.6);}.app-selector img { width: 16px; height: 16px;}.apps-menu { display: none; position: absolute; background-color: #ffffff; min-width: 220px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1); z-index: 10001; right: 0; top: 100%; border-radius: 8px; overflow: hidden;}.apps-menu a { color: #1a1a1a; padding: 10px 16px; text-decoration: none; display: flex; align-items: center; gap: 8px; transition: background-color 0.2s, color 0.2s; font-weight: 400; font-size: 13px;}.apps-menu a:hover { background-color: rgba(0, 120, 212, 0.1); color: #0078d4;}.apps-menu a img { width: 16px; height: 16px;}.apps-menu hr { margin: 4px 0; border: none; border-top: 1px solid #e1e1e1;}.utility-items { display: flex; align-items: center; margin-left: auto; gap: 2px; }.apps-menu-icon { padding: 8px 12px !important; min-width: 40px; justify-content: center; margin-right: 5px;}.apps-menu-icon svg { width: 16px; height: 16px; stroke: #1a1a1a;}.apps-menu-icon:hover svg { stroke: #0078d4;}.menu-content a { display: flex !important; align-items: center; gap: 8px;}.menu-content a svg { width: 16px; height: 16px; flex-shrink: 0;}.control-panel-content { flex: 1; padding: 20px; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 20px; overflow-y: auto;}.control-item { width: 100px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border-radius: 8px; transition: all 0.2s; text-align: center; padding: 10px;}.control-item:hover { background: rgba(0, 120, 212, 0.1); transform: scale(1.05);}.control-item img { width: 48px; height: 48px; margin-bottom: 8px;}.control-item span { font-size: 12px; font-weight: 500; color: #1a1a1a;}.config-section { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}.config-section h3 { margin-top: 0; color: #1a1a1a; font-weight: 600;}.color-options { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;}.color-option { width: 40px; height: 40px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s;}.color-option:hover { transform: scale(1.1);}.color-option.selected { border-color: #0078d4; box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);}.control-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 15px;}.control-group label { font-weight: 500; color: #1a1a1a;}.control-group input, .control-group select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Segoe UI', sans-serif;}.buttons { display: flex; gap: 10px; margin-top: 20px;}.apply-btn { background: #0078d4; color: white;}.apply-btn:hover { background: #106ebe;}.reset-btn { background: #f5f5f5; color: #1a1a1a;}.reset-btn:hover { background: #e5e5e5;}.sync-btn { background: #107c10; color: white;}.sync-btn:hover { background: #0e6b0e;}.datetime-display { text-align: center; font-size: 24px; font-weight: 600; margin: 20px 0; padding: 20px; background: #f8f8f8; border-radius: 8px;}#desktop-context-menu { min-width: 200px; background-color: #ffffff; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); border-radius: 8px; padding: 8px 0; z-index: 10002;}#desktop-context-menu a { color: #1a1a1a; padding: 10px 16px; text-decoration: none; display: block; transition: background-color 0.2s, color 0.2s; font-weight: 400; font-size: 13px; border: none;}#desktop-context-menu a:hover { background-color: rgba(0, 120, 212, 0.1); color: #0078d4;}#desktop-context-menu hr { margin: 4px 0; border: none; border-top: 1px solid #e1e1e1;}#desktop-context-menu .menu-content { min-width: 180px; background-color: #ffffff; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); border-radius: 8px; margin-top: -8px;}@media (max-width: 768px) { .menu-bar { flex-direction: column; align-items: flex-start; } .menu-item { width: 100%; text-align: left; } .menu-content { width: 100%; position: static; box-shadow: none; border-radius: 0; } .content { justify-content: space-around; } .view-icons .shortcut { width: 70px; height: 80px; margin: 5px; } .view-icons .shortcut img { width: 40px; height: 40px; } .view-icons .shortcut-name { font-size: 10px; } .modal-content { width: 95%; margin: 5% auto; } .folder-window { min-width: 300px; min-height: 250px; } .clock-display { margin-left: 0; min-width: 100px; } .utility-items { width: 100%; justify-content: space-between; margin-left: 0; }}@media (min-width: 769px) and (max-width: 1024px) { .content { justify-content: space-around; } .view-icons .shortcut { width: 75px; height: 85px; }}@media (min-width: 1025px) { .content { justify-content: flex-start; }}</style></head><body><div class="program-manager"><div class="menu-bar"><div class="menu-item apps-menu-icon" onclick="toggleMenu('apps-menu')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg><div id="apps-menu" class="menu-content"><a href="#" onclick="openAboutWineBOX()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> About this WineBOX </a><a href="#" onclick="openApp('Calculator', 'http://winebox.cloud/src/apps/calc.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="12" y2="14"></line><line x1="14" y1="14" x2="16" y2="14"></line><line x1="8" y1="18" x2="12" y2="18"></line><line x1="14" y1="18" x2="16" y2="18"></line></svg> Calculator </a><a href="#" onclick="openApp('Calendar', 'http://winebox.cloud/src/apps/calendar.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> Calendar </a><a href="#" onclick="openApp('Clock', 'http://winebox.cloud/src/apps/clock.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Clock </a><a href="#" onclick="openControlPanels()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg> Control Panels </a><a href="#" onclick="openApp('Internet Browser', 'http://winebox.cloud/src/apps/edge.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> Internet Browser </a><a href="#" onclick="openApp('Notepad', 'http://winebox.cloud/src/apps/notepad.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg> Note Pad </a><a href="#" onclick="openApp('Paint', 'http://winebox.cloud/src/apps/paint.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg> Paint </a><a href="#" onclick="openApp('Store', 'winestore.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg> Store </a><a href="#" onclick="openApp('ToDO', 'http://winebox.cloud/src/apps/todo.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg> ToDO </a><a href="#" onclick="openApp('WineZIP', 'http://winebox.cloud/src/apps/winezip.html')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline><polyline points="7.5 19.79 7.5 14.6 3 12"></polyline><polyline points="21 12 16.5 14.6 16.5 19.79"></polyline><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg> WineZIP </a><hr><a href="#" onclick="shutdown()"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 3v18H3V3h18zM9 9H7v6h2V9zM17 9h-2v6h2V9z"/></svg> Shutdown </a></div></div><div class="menu-item" onclick="toggleMenu('file-menu')"> Archivo <div id="file-menu" class="menu-content"><a href="#" onclick="createNewFolder()">Nueva Carpeta</a><a href="#" onclick="closeActiveWindow()">Cerrar Ventana</a><hr><a href="#" onclick="openInstallWizard()">Instalar</a><a href="#" onclick="openUninstallModal()">Desinstalar</a><a href="#" onclick="openNewShortcutWizard()">Nuevo acceso directo</a><hr><a href="#" onclick="openExecuteModal()">Ejecutar...</a></div></div><div class="menu-item" onclick="toggleMenu('edit-menu')"> Edici√≥n <div id="edit-menu" class="menu-content"><a href="#" onclick="undoAction()">Deshacer</a><hr><a href="#" onclick="cutSelection()">Cortar</a><a href="#" onclick="pasteSelection()">Pegar</a><a href="#" onclick="deleteSelection()">Borrar</a><hr><a href="#" onclick="selectAll()">Seleccionar todo</a></div></div><div class="menu-item" onclick="toggleMenu('view-menu')"> Ver <div id="view-menu" class="menu-content"><a href="#" onclick="changeView('icons')">Por iconos grandes</a><a href="#" onclick="changeView('small-icons')">Por iconos peque√±os</a><a href="#" onclick="changeView('list')">Por nombre</a><a href="#" onclick="changeView('dates')">Por fecha</a></div></div><div class="menu-item" onclick="toggleMenu('special-menu')"> Especial <div id="special-menu" class="menu-content"><a href="#" onclick="emptyTrash()">Vaciar Papelera</a><a href="#" onclick="restartProgram()">Reiniciar</a><a href="#" onclick="clearAllData()">Borrar datos</a></div></div><div class="utility-items"><div class="clock-display" id="clock-display" onmousedown="showDateOnClick()" onmouseup="updateClock()" ontouchstart="showDateOnClick()" ontouchend="updateClock()"></div><div class="menu-item help-menu-item" onclick="toggleMenu('help-menu')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0078d4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12" y2="17"></line></svg><div id="help-menu" class="menu-content" style="right: 0; left: auto;"><a href="#" onclick="showHelp()">Contenido</a></div></div><div class="app-selector" onclick="toggleRunningAppsMenu(event)"><img id="current-app-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImZvbGRlckdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRkI3NEQ7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRkY5ODAwO3N0b3Atb3BhY2l0eToxIiAvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSIyOCIgaGVpZ2h0PSIyOCIgcng9IjYiIGZpbGw9InVybCgjZm9sZGVyR3JhZCkiLz48cGF0aCBkPSJNNiAxMmgydjE2SDZ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTYgOGg4bDIgNGgxMiIgZmlsbD0iI0ZGRTBCMiIvPjwvc3ZnPg==" alt="Escritorio"><div id="running-apps-menu" class="apps-menu"><a href="#" onclick="hideCurrentApp()"><span>Ocultar</span></a><a href="#" onclick="hideOtherApps()"><span>Ocultar Otros</span></a><a href="#" onclick="showAllApps()"><span>Mostrar Todos</span></a><hr><div id="running-apps-list"></div></div></div></div></div><div class="content view-icons" id="shortcuts-container"></div></div><div id="desktop-context-menu" class="menu-content" style="display: none; position: fixed;"><a href="#" onclick="restartProgram()">Actualizar</a><hr><a href="#" onclick="pasteSelection()">Pegar</a><a href="#" onclick="undoAction()">Deshacer</a><hr><a href="#" onclick="openNewShortcutWizard()">Nuevo Acceso directo</a><hr><a href="#" onclick="openDesktopConfig()">Configuraci√≥n de pantalla</a></div><div id="new-folder-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('new-folder-modal')">&times;</span><h2>Nueva Carpeta</h2><input type="text" id="folder-name" placeholder="Nombre de la carpeta" required><div class="wizard-buttons"><button onclick="closeModal('new-folder-modal')">Cancelar</button><button onclick="createFolder()">Crear</button></div></div></div><div id="confirm-modal" class="modal confirm-modal"><div class="modal-content"><span class="close" onclick="closeModal('confirm-modal')">&times;</span><h2 id="confirm-title">Confirmar</h2><p id="confirm-message">¬øEst√°s seguro?</p><div class="confirm-buttons"><button class="cancel-btn" onclick="closeModal('confirm-modal')">Cancelar</button><button id="confirm-action-btn" onclick="executeConfirmedAction()">Aceptar</button></div></div></div><div id="message-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('message-modal')">&times;</span><h2 id="message-title">Mensaje</h2><p id="message-text"></p><div class="wizard-buttons"><button onclick="closeModal('message-modal')">Aceptar</button></div></div></div><div id="install-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('install-modal')">&times;</span><h2>Asistente de instalaci√≥n</h2><div id="wizard-step-1" class="wizard-step active"><h3>Paso 1: Seleccionar archivo ZIP</h3><input type="file" id="zip-file" accept=".zip" required><div class="wizard-buttons"><button onclick="closeModal('install-modal')">Cancelar</button><button onclick="nextStep(1)">Siguiente</button></div></div><div id="wizard-step-2" class="wizard-step"><h3>Paso 2: Nombre del acceso directo</h3><input type="text" id="shortcut-name" placeholder="Nombre del acceso directo" required><div class="wizard-buttons"><button onclick="prevStep(2)">Anterior</button><button onclick="nextStep(2)">Siguiente</button></div></div><div id="wizard-step-3" class="wizard-step"><h3>Paso 3: Icono del acceso directo</h3><input type="file" id="shortcut-icon" accept="image/*"><p class="warning" id="icon-warning" style="display:none;">No se ha seleccionado un icono. Se usar√° un icono gen√©rico.</p><div class="wizard-buttons"><button onclick="prevStep(3)">Anterior</button><button onclick="finishInstallation()">Finalizar</button></div></div></div></div><div id="new-shortcut-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('new-shortcut-modal')">&times;</span><h2>Nuevo acceso directo web</h2><div id="web-wizard-step-1" class="wizard-step active"><h3>Paso 1: Seleccionar tipo de contenido</h3><div class="url-type-selector"><button id="web-url-btn" class="active" onclick="setUrlType('web')">Direcci√≥n Web</button><button id="html-file-btn" onclick="setUrlType('html')">Archivo HTML</button></div><div id="web-url-input"><input type="url" id="web-url" placeholder="https://ejemplo.com" required></div><div id="html-file-input" style="display:none;"><input type="file" id="html-file" accept=".html,.htm" required></div><div class="wizard-buttons"><button onclick="closeModal('new-shortcut-modal')">Cancelar</button><button onclick="nextWebStep(1)">Siguiente</button></div></div><div id="web-wizard-step-2" class="wizard-step"><h3>Paso 2: Nombre del acceso directo</h3><input type="text" id="web-shortcut-name" placeholder="Nombre del acceso directo" required><div class="wizard-buttons"><button onclick="prevWebStep(2)">Anterior</button><button onclick="nextWebStep(2)">Siguiente</button></div></div><div id="web-wizard-step-3" class="wizard-step"><h3>Paso 3: Icono del acceso directo</h3><input type="file" id="web-shortcut-icon" accept="image/*"><p class="warning" id="web-icon-warning" style="display:none;">No se ha seleccionado un icono. Se usar√° un icono gen√©rico.</p><div class="wizard-buttons"><button onclick="prevWebStep(3)">Anterior</button><button onclick="finishWebShortcut()">Finalizar</button></div></div></div></div><div id="uninstall-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('uninstall-modal')">&times;</span><h2>Desinstalar aplicaci√≥n</h2><select id="uninstall-select"></select><button onclick="uninstallShortcut()">Desinstalar</button></div></div><div id="execute-modal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('execute-modal')">&times;</span><h2>Ejecutar aplicaci√≥n</h2><input type="file" id="execute-file" accept=".zip"><button onclick="executeZip()">Ejecutar</button></div></div><div id="help-window" class="folder-window" style="display: none; width: 700px; height: 550px; left: 200px; top: 150px;"><div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12" y2="17"></line></svg> Ayuda - Program Manager v1.73 </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('help-window')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('help-window')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeFolder('help-window')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="help-content" id="help-content"><div class="help-header"><h1>Program Manager v1.73</h1><p class="version-info">√öltima actualizaci√≥n: <span id="current-date"></span></p></div><div class="help-section"><h2>üìã Introducci√≥n</h2><p>Bienvenido al Administrador de Programas estilo Windows 11. Esta aplicaci√≥n te permite crear accesos directos a archivos ZIP que contienen aplicaciones ejecutables, as√≠ como a sitios web y archivos HTML locales.</p></div><div class="help-section"><h2>ü™ü Sistema de Ventanas Mejorado (v1.73)</h2><p>Nuevo sistema de ventanas con botones de minimizar, maximizar y cerrar:</p><h3>Caracter√≠sticas del sistema de ventanas:</h3><ul><li><strong>Minimizar:</strong> Oculta completamente la ventana</li><li><strong>Maximizar/Restaurar:</strong> Alterna entre pantalla completa y tama√±o original</li><li><strong>Cerrar:</strong> Cierra permanentemente la ventana</li><li><strong>Gesti√≥n desde men√∫:</strong> Control de ventanas minimizadas desde el selector de aplicaciones</li></ul></div><div class="help-section"><h2>‚öôÔ∏è Paneles de Control Mejorados</h2><p>Sistema completamente renovado de paneles de control con:</p><ul><li><strong>Desktop Config mejorado:</strong> Vista previa de fondos, im√°genes locales, web y preestablecidas</li><li><strong>Multitarea corregida:</strong> Iconos gen√©ricos para todas las aplicaciones y limpieza autom√°tica</li><li><strong>Color:</strong> Configura colores del escritorio, men√∫s y ventanas</li><li><strong>Date & Time:</strong> Ajusta fecha, hora y zona horaria</li><li><strong>Mouse:</strong> Configura comportamiento del clic</li><li><strong>Text:</strong> Modifica fuentes y estilos de texto</li><li><strong>Windows:</strong> Personaliza apariencia de ventanas</li></ul></div><div class="help-section"><h2>‚è∞ Caracter√≠sticas Principales</h2><ul><li><strong>Reloj en tiempo real</strong> en la barra de men√∫ con formato AM/PM</li><li><strong>Selector de aplicaciones</strong> con gesti√≥n de ventanas corregida</li><li><strong>Tres botones de ventana</strong> (minimizar, maximizar, cerrar)</li><li><strong>Maximizado inteligente</strong> que respeta los m√°rgenes de la interfaz</li><li><strong>Sistema de multitarea mejorado</strong> sin ventanas fantasma</li></ul></div><div class="help-footer"><p>Program Manager v1.73 - Sistema Mejorado de Ventanas y Paneles de Control</p><p>Compatibilidad: Chrome, Firefox, Edge, Safari</p></div></div></div></div></div><script>let systemConfig = { colors: { desktop: '#0078d4', menuBar: 'rgba(255, 255, 255, 0.9)', window: 'rgba(255, 255, 255, 0.95)' }, datetime: { timeFormat: '12', timezone: 'auto' }, desktop: { background: 'https://windows11.now.sh/img/backgrounds/default.jpg', showControlPanels: true, showDiscoLocal: true, showTrash: true }, mouse: { clickMode: 'double' }, text: { fontFamily: "'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif", fontSize: '14px' }, windows: { showButtons: true, buttonOrder: 'minimize,maximize,close', borderSize: '1px' }};function loadSystemConfig() { const savedConfig = localStorage.getItem('systemConfig'); if (savedConfig) { systemConfig = JSON.parse(savedConfig); applySystemConfig(); }}function saveSystemConfig() { localStorage.setItem('systemConfig', JSON.stringify(systemConfig)); applySystemConfig();}const configAppIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="16" height="16"><defs><linearGradient id="configGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#0078d4;stop-opacity:1"/><stop offset="100%" style="stop-color:#106ebe;stop-opacity:1"/></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#configGrad)"/><rect x="8" y="8" width="16" height="16" rx="3" fill="#ffffff"/><circle cx="16" cy="16" r="4" fill="#0078d4"/><circle cx="10" cy="10" r="1" fill="#0078d4"/><circle cx="22" cy="10" r="1" fill="#0078d4"/><circle cx="10" cy="22" r="1" fill="#0078d4"/><circle cx="22" cy="22" r="1" fill="#0078d4"/></svg>`;function applySystemConfig() { document.querySelector('.program-manager').style.backgroundColor = systemConfig.colors.desktop; document.querySelector('.menu-bar').style.backgroundColor = systemConfig.colors.menuBar; document.body.style.fontFamily = systemConfig.text.fontFamily; document.body.style.fontSize = systemConfig.text.fontSize; if (systemConfig.desktop.background) { document.querySelector('.program-manager').style.backgroundImage = `url('${systemConfig.desktop.background}')`; } updateClock();}function openControlPanels() { const windowId = 'control-panels'; let controlPanelWindow = document.getElementById(windowId); if (!controlPanelWindow) { controlPanelWindow = document.createElement('div'); controlPanelWindow.className = 'folder-window app-window'; controlPanelWindow.id = windowId; controlPanelWindow.style.display = 'flex'; controlPanelWindow.style.left = '200px'; controlPanelWindow.style.top = '150px'; controlPanelWindow.style.width = '600px'; controlPanelWindow.style.height = '500px'; controlPanelWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg> Control Panels </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="control-panel-content"><div class="control-item" onclick="openColorConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA3OGQ0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIzIi8+PGxpbmUgeDE9IjEyIiB5MT0iMiIgeDI9IjEyIiB5Mj0iNCIvPjxsaW5lIHgxPSIxMiIgeTE9IjIwIiB4Mj0iMTIiIHkyPSIyMiIvPjxsaW5lIHgxPSI0LjkzIiB5MT0iNC45MyIgeDI9IjYuMzQiIHkyPSI2LjM0Ii8+PGxpbmUgeDE9IjE3LjY2IiB5MT0iMTcuNjYiIHgyPSIxOS4wNyIgeTI9IjE5LjA3Ii8+PGxpbmUgeDE9IjIiIHkxPSIxMiIgeDI9IjQiIHkyPSIxMiIvPjxsaW5lIHgxPSIyMCIgeTE9IjEyIiB4Mj0iMjIiIHkyPSIxMiIvPjxsaW5lIHgxPSI0LjkzIiB5MT0iMTkuMDciIHgyPSI2LjM0IiB5Mj0iMTcuNjYiLz48bGluZSB4MT0iMTcuNjYiIHkxPSI2LjM0IiB4Mj0iMTkuMDciIHkyPSI0LjkzIi8+PC9zdmc+" alt="Color" width="48" height="48"><span>Color</span></div><div class="control-item" onclick="openDateTimeConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzAwNzhkNCIvPjxjaXJjbGUgY3g9IjI0IiBjeT0iMjQiIHI9IjEwIiBmaWxsPSIjZmZmIi8+PHBvbHlsaW5lIHBvaW50cz0iMjQgMTIgMjQgMjQgMTggMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwNzhkNCIgc3Ryb2tlLXdpZHRoPSIyIi8+PC9zdmc+" alt="Date & Time"><span>Date & Time</span></div><div class="control-item" onclick="openDesktopConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3QgeD0iNCIgeT0iNCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjMwIiByeD0iMiIgZmlsbD0iIzAwNzhkNCIvPjxyZWN0IHg9IjgiIHk9IjgiIHdpZHRoPSIzMiIgaGVpZ2h0PSIxOCIgcng9IjIiIGZpbGw9IiNmZmYiLz48Y2lyY2xlIGN4PSIxNiIgY3k9IjM4IiByPSIyIiBmaWxsPSIjMDA3OGQ0Ii8+PGNpcmNsZSBjeD0iMjQiIGN5PSIzOCIgcj0iMiIgZmlsbD0iIzAwNzhkNCIvPjxjaXJjbGUgY3g9IjMyIiBjeT0iMzgiIHI9IjIiIGZpbGw9IiMwMDc4ZDAiLz48L3N2Zz4=" alt="Desktop"><span>Desktop</span></div><div class="control-item" onclick="openMouseConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZD0iTTI0IDhMMTQgMjJoNnYxMGg4VjIyaDZMMjQgOHoiIGZpbGw9IiMwMDc4ZDAiLz48L3N2Zz4=" alt="Mouse"><span>Mouse</span></div><div class="control-item" onclick="openTextConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHBhdGggZD0iTTEyIDhoMjR2NEgxMlY4em0wIDhoMjR2NEgxMnYtOHptMCA4aDE2djRIMTJ2LTR6IiBmaWxsPSIjMDA3OGQwIi8+PC9zdmc+" alt="Text"><span>Text</span></div><div class="control-item" onclick="openWindowsConfig()"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzAwNzhkNCIvPjxyZWN0IHg9IjEyIiB5PSIxMiIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiByeD0iMiIgZmlsbD0iI2ZmZiIvPjxyZWN0IHg9IjI2IiB5PSIxMiIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiByeD0iMiIgZmlsbD0iI2ZmZiIvPjxyZWN0IHg9IjEyIiB5PSIyNiIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiByeD0iMiIgZmlsbD0iI2ZmZiIvPjxyZWN0IHg9IjI2IiB5PSIyNiIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiByeD0iMiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==" alt="Windows"><span>Windows</span></div></div></div></div> `; document.querySelector('.program-manager').appendChild(controlPanelWindow); const appWindow = { id: windowId, title: "Control Panels", type: 'control-panel', position: { x: 200, y: 150 }, size: { width: 600, height: 500 }, isMinimized: false, isMaximized: false, icon: 'data:image/svg+xml;base64,' + btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>`) }; appWindows.push(appWindow); registerWindow(controlPanelWindow); makeDraggable(controlPanelWindow); makeResizable(controlPanelWindow); } else { controlPanelWindow.style.display = 'flex'; bringWindowToFront(windowId); } closeAllMenus();}function openColorConfig() { const windowId = 'color-config'; let colorWindow = document.getElementById(windowId); if (!colorWindow) { colorWindow = document.createElement('div'); colorWindow.className = 'folder-window'; colorWindow.id = windowId; colorWindow.style.display = 'flex'; colorWindow.style.left = '250px'; colorWindow.style.top = '180px'; colorWindow.style.width = '500px'; colorWindow.style.height = '600px'; colorWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle><line x1="12" y1="2" x2="12" y2="4"></line><line x1="12" y1="20" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="6.34" y2="6.34"></line><line x1="17.66" y1="17.66" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="4" y2="12"></line><line x1="20" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="6.34" y2="17.66"></line><line x1="17.66" y1="6.34" x2="19.07" y2="4.93"></line></svg> Color Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Desktop Background Color</h3><div class="color-options"><div class="color-option ${systemConfig.colors.desktop === '#f3f3f3' ? 'selected' : ''}" style="background: #f3f3f3;" data-color="#f3f3f3" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#0078d4' ? 'selected' : ''}" style="background: #0078d4;" data-color="#0078d4" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#107c10' ? 'selected' : ''}" style="background: #107c10;" data-color="#107c10" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#d83b01' ? 'selected' : ''}" style="background: #d83b01;" data-color="#d83b01" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#e3008c' ? 'selected' : ''}" style="background: #e3008c;" data-color="#e3008c" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#b4009e' ? 'selected' : ''}" style="background: #b4009e;" data-color="#b4009e" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#5c2d91' ? 'selected' : ''}" style="background: #5c2d91;" data-color="#5c2d91" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#0078d7' ? 'selected' : ''}" style="background: #0078d7;" data-color="#0078d7" data-type="desktop"></div><div class="color-option ${systemConfig.colors.desktop === '#008272' ? 'selected' : ''}" style="background: #008272;" data-color="#008272" data-type="desktop"></div></div></div><div class="config-section"><h3>Menu Bar Color</h3><div class="color-options"><div class="color-option ${systemConfig.colors.menuBar === 'rgba(255, 255, 255, 0.9)' ? 'selected' : ''}" style="background: rgba(255, 255, 255, 0.9);" data-color="rgba(255, 255, 255, 0.9)" data-type="menuBar"></div><div class="color-option ${systemConfig.colors.menuBar === 'rgba(240, 240, 240, 0.9)' ? 'selected' : ''}" style="background: rgba(240, 240, 240, 0.9);" data-color="rgba(240, 240, 240, 0.9)" data-type="menuBar"></div><div class="color-option ${systemConfig.colors.menuBar === 'rgba(0, 120, 212, 0.9)' ? 'selected' : ''}" style="background: rgba(0, 120, 212, 0.9);" data-color="rgba(0, 120, 212, 0.9)" data-type="menuBar"></div><div class="color-option ${systemConfig.colors.menuBar === 'rgba(245, 245, 245, 0.9)' ? 'selected' : ''}" style="background: rgba(245, 245, 245, 0.9);" data-color="rgba(245, 245, 245, 0.9)" data-type="menuBar"></div></div></div><div class="config-section"><h3>Window Color</h3><div class="color-options"><div class="color-option ${systemConfig.colors.window === 'rgba(255, 255, 255, 0.95)' ? 'selected' : ''}" style="background: rgba(255, 255, 255, 0.95);" data-color="rgba(255, 255, 255, 0.95)" data-type="window"></div><div class="color-option ${systemConfig.colors.window === 'rgba(248, 248, 248, 0.95)' ? 'selected' : ''}" style="background: rgba(248, 248, 248, 0.95);" data-color="rgba(248, 248, 248, 0.95)" data-type="window"></div><div class="color-option ${systemConfig.colors.window === 'rgba(240, 240, 240, 0.95)' ? 'selected' : ''}" style="background: rgba(240, 240, 240, 0.95);" data-color="rgba(240, 240, 240, 0.95)" data-type="window"></div><div class="color-option ${systemConfig.colors.window === 'rgba(255, 250, 250, 0.95)' ? 'selected' : ''}" style="background: rgba(255, 250, 250, 0.95);" data-color="rgba(255, 250, 250, 0.95)" data-type="window"></div></div></div><div class="buttons"><button class="apply-btn" onclick="applyColorChanges()">Apply Changes</button><button class="reset-btn" onclick="resetColorToDefault()">Reset to Default</button></div></div></div> `; document.querySelector('.program-manager').appendChild(colorWindow); registerWindow(colorWindow); makeDraggable(colorWindow); makeResizable(colorWindow); setTimeout(() => { document.querySelectorAll('.color-option').forEach(option => { option.addEventListener('click', function() { const type = this.getAttribute('data-type'); const color = this.getAttribute('data-color'); this.closest('.config-section').querySelectorAll('.color-option').forEach(opt => { opt.classList.remove('selected'); }); this.classList.add('selected'); systemConfig.colors[type] = color; }); }); }, 0); } else { colorWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function applyColorChanges() { saveSystemConfig(); showMessage('Color Configuration', 'Color settings applied successfully!');}function resetColorToDefault() { systemConfig.colors = { desktop: '#0078d4', menuBar: 'rgba(255, 255, 255, 0.9)', window: 'rgba(255, 255, 255, 0.95)' }; saveSystemConfig(); showMessage('Color Configuration', 'Color settings reset to default!'); closeFolder('color-config'); openColorConfig();}function openDateTimeConfig() { const windowId = 'datetime-config'; let datetimeWindow = document.getElementById(windowId); if (!datetimeWindow) { datetimeWindow = document.createElement('div'); datetimeWindow.className = 'folder-window'; datetimeWindow.id = windowId; datetimeWindow.style.display = 'flex'; datetimeWindow.style.left = '250px'; datetimeWindow.style.top = '180px'; datetimeWindow.style.width = '500px'; datetimeWindow.style.height = '500px'; datetimeWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Date & Time Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Current Date & Time</h3><div class="datetime-display" id="current-datetime-display"> ${new Date().toLocaleString()} </div></div><div class="config-section"><h3>Time Format</h3><div class="control-group"><select id="time-format-select"><option value="12" ${systemConfig.datetime.timeFormat === '12' ? 'selected' : ''}>12-hour (AM/PM)</option><option value="24" ${systemConfig.datetime.timeFormat === '24' ? 'selected' : ''}>24-hour</option></select></div></div><div class="config-section"><h3>Time Zone</h3><div class="control-group"><select id="timezone-select"><option value="auto" ${systemConfig.datetime.timezone === 'auto' ? 'selected' : ''}>Auto-detect</option><option value="utc-8" ${systemConfig.datetime.timezone === 'utc-8' ? 'selected' : ''}>Pacific Time (UTC-8)</option><option value="utc-5" ${systemConfig.datetime.timezone === 'utc-5' ? 'selected' : ''}>Eastern Time (UTC-5)</option><option value="utc-0" ${systemConfig.datetime.timezone === 'utc-0' ? 'selected' : ''}>GMT (UTC+0)</option><option value="utc+1" ${systemConfig.datetime.timezone === 'utc+1' ? 'selected' : ''}>Central European Time (UTC+1)</option><option value="utc+8" ${systemConfig.datetime.timezone === 'utc+8' ? 'selected' : ''}>China Standard Time (UTC+8)</option></select></div></div><div class="buttons"><button class="apply-btn" onclick="applyDateTimeChanges()">Apply Changes</button><button class="sync-btn" onclick="syncDateTime()">Sync with System</button></div></div></div> `; document.querySelector('.program-manager').appendChild(datetimeWindow); registerWindow(datetimeWindow); makeDraggable(datetimeWindow); makeResizable(datetimeWindow); const updateDisplay = () => { const display = document.getElementById('current-datetime-display'); if (display) { display.textContent = new Date().toLocaleString(); } }; datetimeWindow.updateInterval = setInterval(updateDisplay, 1000); } else { datetimeWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function applyDateTimeChanges() { const timeFormat = document.getElementById('time-format-select').value; const timezone = document.getElementById('timezone-select').value; systemConfig.datetime.timeFormat = timeFormat; systemConfig.datetime.timezone = timezone; saveSystemConfig(); updateClock(); showMessage('Date & Time', 'Date and time settings applied successfully!');}function syncDateTime() { systemConfig.datetime.timeFormat = '12'; systemConfig.datetime.timezone = 'auto'; saveSystemConfig(); showMessage('Date & Time', 'Date and time synchronized with system!'); closeFolder('datetime-config'); openDateTimeConfig();}function openDesktopConfig() { const windowId = 'desktop-config'; let desktopWindow = document.getElementById(windowId); if (!desktopWindow) { desktopWindow = document.createElement('div'); desktopWindow.className = 'folder-window'; desktopWindow.id = windowId; desktopWindow.style.display = 'flex'; desktopWindow.style.left = '250px'; desktopWindow.style.top = '180px'; desktopWindow.style.width = '600px'; desktopWindow.style.height = '700px'; desktopWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2" ry="2"></rect><rect x="7" y="7" width="10" height="10"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line></svg> Desktop Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Current Desktop Preview</h3><div id="desktop-preview" style="width: 100%; height: 150px; background-size: cover; background-position: center; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: #666; font-style: italic;"> Desktop Preview </div></div><div class="config-section"><h3>Desktop Background</h3><div class="control-group"><label>Select Background Source:</label><select id="background-source" onchange="toggleBackgroundSource()"><option value="local">Local Image</option><option value="web">Web Image</option><option value="preset">Preset Images</option></select></div><div id="local-background-section"><div class="control-group"><label>Upload Local Image:</label><input type="file" id="local-background-file" accept="image/*" onchange="previewLocalImage(this)"></div></div><div id="web-background-section" style="display: none;"><div class="control-group"><label>Web Image URL:</label><input type="text" id="web-background-url" placeholder="https://example.com/image.jpg" oninput="previewWebImage(this.value)"><button onclick="testWebImage()" style="margin-top: 5px; padding: 5px 10px;">Test URL</button></div></div><div id="preset-background-section" style="display: none;"><div class="control-group"><label>Select Preset Background:</label><div class="preset-backgrounds" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; max-height: 300px; overflow-y: auto;"></div></div></div><button class="apply-btn" onclick="updateDesktopBackground()" style="margin-top: 15px;">Apply Background</button></div><div class="config-section"><h3>Desktop Icons</h3><div class="control-group"><label><input type="checkbox" id="show-control-panels" ${systemConfig.desktop.showControlPanels ? 'checked' : ''}> Show Control Panels shortcut </label></div><div class="control-group"><label><input type="checkbox" id="show-disco-local" ${systemConfig.desktop.showDiscoLocal ? 'checked' : ''}> Show Disco Local shortcut </label></div><div class="control-group"><label><input type="checkbox" id="show-trash" ${systemConfig.desktop.showTrash ? 'checked' : ''}> Show Trash shortcut </label></div></div><div class="buttons"><button class="apply-btn" onclick="applyDesktopChanges()">Apply All Changes</button><button class="reset-btn" onclick="resetDesktopToDefault()">Reset to Default</button></div></div></div> `; document.querySelector('.program-manager').appendChild(desktopWindow); registerWindow(desktopWindow); makeDraggable(desktopWindow); makeResizable(desktopWindow); updateDesktopPreview(); loadPresetImages(); } else { desktopWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function loadPresetImages() { const presetContainer = document.querySelector('.preset-backgrounds'); if (!presetContainer) return; presetContainer.innerHTML = ''; for (let i = 18; i <= 35; i++) { const imgUrl = `src/wallpaper/img${i}.jpg`; const presetElement = document.createElement('div'); presetElement.className = 'preset-bg'; presetElement.style.cssText = 'width: 100%; height: 80px; background-size: cover; cursor: pointer; border: 2px solid transparent; border-radius: 4px; position: relative; overflow: hidden;'; presetElement.setAttribute('data-url', imgUrl); presetElement.innerHTML = ` <div style="background: url('${imgUrl}'); background-size: cover; width: 100%; height: 100%; border-radius: 2px; display: flex; align-items: center; justify-content: center;"><div style="background: rgba(0,0,0,0.5); color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px;">img${i}.jpg</div></div> `; presetElement.addEventListener('click', function() { selectPresetBackground(imgUrl, this); }); presetContainer.appendChild(presetElement); }}function selectPresetBackground(url, element) { document.querySelectorAll('.preset-bg').forEach(bg => { bg.style.borderColor = 'transparent'; }); if (element) { element.style.borderColor = '#0078d4'; } document.getElementById('desktop-preview').style.backgroundImage = `url('${url}')`; document.getElementById('desktop-preview').textContent = ''; document.getElementById('web-background-url').value = url; document.getElementById('background-source').value = 'web'; toggleBackgroundSource();}function toggleBackgroundSource() { const source = document.getElementById('background-source').value; document.getElementById('local-background-section').style.display = source === 'local' ? 'block' : 'none'; document.getElementById('web-background-section').style.display = source === 'web' ? 'block' : 'none'; document.getElementById('preset-background-section').style.display = source === 'preset' ? 'block' : 'none'; if (source === 'preset') { loadPresetImages(); }}function previewLocalImage(input) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { document.getElementById('desktop-preview').style.backgroundImage = `url('${e.target.result}')`; document.getElementById('desktop-preview').textContent = ''; }; reader.readAsDataURL(input.files[0]); }}function previewWebImage(url) { if (url) { document.getElementById('desktop-preview').style.backgroundImage = `url('${url}')`; document.getElementById('desktop-preview').textContent = ''; }}function testWebImage() { const url = document.getElementById('web-background-url').value; if (url) { previewWebImage(url); }}function updateDesktopPreview() { const preview = document.getElementById('desktop-preview'); if (preview && systemConfig.desktop.background) { preview.style.backgroundImage = `url('${systemConfig.desktop.background}')`; preview.textContent = ''; }}function updateDesktopBackground() { const source = document.getElementById('background-source').value; let backgroundUrl = ''; if (source === 'local') { const fileInput = document.getElementById('local-background-file'); if (fileInput.files && fileInput.files[0]) { const reader = new FileReader(); reader.onload = function(e) { backgroundUrl = e.target.result; systemConfig.desktop.background = backgroundUrl; saveSystemConfig(); showMessage('Desktop Configuration', 'Background updated successfully!'); updateDesktopPreview(); }; reader.readAsDataURL(fileInput.files[0]); return; } else { showMessage('Error', 'Please select a local image file.'); return; } } else if (source === 'web' || source === 'preset') { backgroundUrl = document.getElementById('web-background-url').value; if (!backgroundUrl) { showMessage('Error', 'Please enter a valid image URL.'); return; } } systemConfig.desktop.background = backgroundUrl; saveSystemConfig(); showMessage('Desktop Configuration', 'Background updated successfully!'); updateDesktopPreview();}function applyDesktopChanges() { systemConfig.desktop.showControlPanels = document.getElementById('show-control-panels').checked; systemConfig.desktop.showDiscoLocal = document.getElementById('show-disco-local').checked; systemConfig.desktop.showTrash = document.getElementById('show-trash').checked; saveSystemConfig(); renderShortcuts(); showMessage('Desktop Configuration', 'Desktop settings applied successfully!');}function resetDesktopToDefault() { systemConfig.desktop = { background: 'https://windows11.now.sh/img/backgrounds/default.jpg', showControlPanels: true, showDiscoLocal: true, showTrash: true }; saveSystemConfig(); showMessage('Desktop Configuration', 'Desktop settings reset to default!'); closeFolder('desktop-config'); setTimeout(() => { openDesktopConfig(); }, 100);}function openMouseConfig() { const windowId = 'mouse-config'; let mouseWindow = document.getElementById(windowId); if (!mouseWindow) { mouseWindow = document.createElement('div'); mouseWindow.className = 'folder-window'; mouseWindow.id = windowId; mouseWindow.style.display = 'flex'; mouseWindow.style.left = '250px'; mouseWindow.style.top = '180px'; mouseWindow.style.width = '500px'; mouseWindow.style.height = '400px'; mouseWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a6 6 0 0 0-6 6v4a6 6 0 0 0 12 0V8a6 6 0 0 0-6-6z"></path><path d="M12 2v4"></path><path d="M12 18v4"></path></svg> Mouse Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Click Behavior</h3><div class="control-group"><label><input type="radio" name="click-mode" value="single" ${systemConfig.mouse.clickMode === 'single' ? 'checked' : ''}> Single-click to open items </label></div><div class="control-group"><label><input type="radio" name="click-mode" value="double" ${systemConfig.mouse.clickMode === 'double' ? 'checked' : ''}> Double-click to open items </label></div></div><div class="buttons"><button class="apply-btn" onclick="applyMouseChanges()">Apply Changes</button><button class="reset-btn" onclick="resetMouseToDefault()">Reset to Default</button></div></div></div> `; document.querySelector('.program-manager').appendChild(mouseWindow); registerWindow(mouseWindow); makeDraggable(mouseWindow); makeResizable(mouseWindow); } else { mouseWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function applyMouseChanges() { const clickMode = document.querySelector('input[name="click-mode"]:checked').value; systemConfig.mouse.clickMode = clickMode; saveSystemConfig(); showMessage('Mouse Configuration', 'Mouse settings applied successfully!');}function resetMouseToDefault() { systemConfig.mouse.clickMode = 'double'; saveSystemConfig(); showMessage('Mouse Configuration', 'Mouse settings reset to default!'); closeFolder('mouse-config'); openMouseConfig();}function openTextConfig() { const windowId = 'text-config'; let textWindow = document.getElementById(windowId); if (!textWindow) { textWindow = document.createElement('div'); textWindow.className = 'folder-window'; textWindow.id = windowId; textWindow.style.display = 'flex'; textWindow.style.left = '250px'; textWindow.style.top = '180px'; textWindow.style.width = '500px'; textWindow.style.height = '500px'; textWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7V4h16v3"></path><path d="M5 20h6"></path><path d="M13 4 8 20"></path><path d="M15 15h5"></path></svg> Text Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Font Family</h3><div class="control-group"><select id="font-family-select"><option value="'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif" ${systemConfig.text.fontFamily.includes('Segoe UI') ? 'selected' : ''}>Segoe UI (Windows)</option><option value="'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" ${systemConfig.text.fontFamily.includes('SF Pro') ? 'selected' : ''}>SF Pro (macOS)</option><option value="'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif" ${systemConfig.text.fontFamily.includes('Roboto') ? 'selected' : ''}>Roboto (Android)</option><option value="Arial, Helvetica, sans-serif" ${systemConfig.text.fontFamily.includes('Arial') ? 'selected' : ''}>Arial</option><option value="'Times New Roman', Times, serif" ${systemConfig.text.fontFamily.includes('Times') ? 'selected' : ''}>Times New Roman</option></select></div></div><div class="config-section"><h3>Font Size</h3><div class="control-group"><select id="font-size-select"><option value="12px" ${systemConfig.text.fontSize === '12px' ? 'selected' : ''}>Small (12px)</option><option value="14px" ${systemConfig.text.fontSize === '14px' ? 'selected' : ''}>Medium (14px)</option><option value="16px" ${systemConfig.text.fontSize === '16px' ? 'selected' : ''}>Large (16px)</option><option value="18px" ${systemConfig.text.fontSize === '18px' ? 'selected' : ''}>Extra Large (18px)</option></select></div></div><div class="buttons"><button class="apply-btn" onclick="applyTextChanges()">Apply Changes</button><button class="reset-btn" onclick="resetTextToDefault()">Reset to Default</button></div></div></div> `; document.querySelector('.program-manager').appendChild(textWindow); registerWindow(textWindow); makeDraggable(textWindow); makeResizable(textWindow); } else { textWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function applyTextChanges() { const fontFamily = document.getElementById('font-family-select').value; const fontSize = document.getElementById('font-size-select').value; systemConfig.text.fontFamily = fontFamily; systemConfig.text.fontSize = fontSize; saveSystemConfig(); showMessage('Text Configuration', 'Text settings applied successfully!');}function resetTextToDefault() { systemConfig.text = { fontFamily: "'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif", fontSize: '14px' }; saveSystemConfig(); showMessage('Text Configuration', 'Text settings reset to default!'); closeFolder('text-config'); openTextConfig();}function openWindowsConfig() { const windowId = 'windows-config'; let windowsWindow = document.getElementById(windowId); if (!windowsWindow) { windowsWindow = document.createElement('div'); windowsWindow.className = 'folder-window'; windowsWindow.id = windowId; windowsWindow.style.display = 'flex'; windowsWindow.style.left = '250px'; windowsWindow.style.top = '180px'; windowsWindow.style.width = '500px'; windowsWindow.style.height = '500px'; windowsWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg> Windows Configuration </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${windowId}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${windowId}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeControlPanel('${windowId}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area"><div class="config-section"><h3>Window Buttons</h3><div class="control-group"><label><input type="checkbox" id="show-window-buttons" ${systemConfig.windows.showButtons ? 'checked' : ''}> Show window control buttons (minimize, maximize, close) </label></div></div><div class="config-section"><h3>Button Order</h3><div class="control-group"><select id="button-order-select"><option value="minimize,maximize,close" ${systemConfig.windows.buttonOrder === 'minimize,maximize,close' ? 'selected' : ''}>Minimize - Maximize - Close</option><option value="close,maximize,minimize" ${systemConfig.windows.buttonOrder === 'close,maximize,minimize' ? 'selected' : ''}>Close - Maximize - Minimize</option><option value="maximize,minimize,close" ${systemConfig.windows.buttonOrder === 'maximize,minimize,close' ? 'selected' : ''}>Maximize - Minimize - Close</option></select></div></div><div class="config-section"><h3>Window Border</h3><div class="control-group"><select id="border-size-select"><option value="0px" ${systemConfig.windows.borderSize === '0px' ? 'selected' : ''}>No border</option><option value="1px" ${systemConfig.windows.borderSize === '1px' ? 'selected' : ''}>Thin border (1px)</option><option value="2px" ${systemConfig.windows.borderSize === '2px' ? 'selected' : ''}>Medium border (2px)</option><option value="3px" ${systemConfig.windows.borderSize === '3px' ? 'selected' : ''}>Thick border (3px)</option></select></div></div><div class="buttons"><button class="apply-btn" onclick="applyWindowsChanges()">Apply Changes</button><button class="reset-btn" onclick="resetWindowsToDefault()">Reset to Default</button></div></div></div> `; document.querySelector('.program-manager').appendChild(windowsWindow); registerWindow(windowsWindow); makeDraggable(windowsWindow); makeResizable(windowsWindow); } else { windowsWindow.style.display = 'flex'; bringWindowToFront(windowId); }}function applyWindowsChanges() { systemConfig.windows.showButtons = document.getElementById('show-window-buttons').checked; systemConfig.windows.buttonOrder = document.getElementById('button-order-select').value; systemConfig.windows.borderSize = document.getElementById('border-size-select').value; saveSystemConfig(); showMessage('Windows Configuration', 'Windows settings applied successfully!'); renderFolders();}function resetWindowsToDefault() { systemConfig.windows = { showButtons: true, buttonOrder: 'minimize,maximize,close', borderSize: '1px' }; saveSystemConfig(); showMessage('Windows Configuration', 'Windows settings reset to default!'); closeFolder('windows-config'); openWindowsConfig();}function toggleRunningAppsMenu(event) { event.stopPropagation(); const runningAppsMenu = document.getElementById('running-apps-menu'); const isVisible = runningAppsMenu.style.display === 'block'; closeAllMenus(); if (!isVisible) { updateRunningAppsList(); runningAppsMenu.style.display = 'block'; }}function closeActiveWindow() { const activeWindow = getActiveWindow(); if (activeWindow) { if (activeWindow.element.classList.contains('app-window')) { const appWindow = appWindows.find(w => w.id === activeWindow.id); if (appWindow) { closeAppWindow(activeWindow.id); } } else { closeFolder(activeWindow.id); } showMessage('Ventana cerrada', 'La ventana activa se ha cerrado correctamente.'); } else { showMessage('Informaci√≥n', 'No hay ventanas activas para cerrar.'); } closeAllMenus();}let windowOriginalStates = new Map();function minimizeWindow(windowId) { const windowElement = document.getElementById(windowId); if (windowElement) { windowElement.classList.add('window-minimized'); windowElement.style.display = 'none'; const appWindow = appWindows.find(w => w.id === windowId); if (appWindow) { appWindow.isMinimized = true; } updateRunningAppsList(); updateActiveAppIcon(); }}function restoreWindow(windowId) { const windowElement = document.getElementById(windowId); if (windowElement) { windowElement.classList.remove('window-minimized'); windowElement.style.display = 'flex'; const appWindow = appWindows.find(w => w.id === windowId); if (appWindow) { appWindow.isMinimized = false; } bringWindowToFront(windowId); updateRunningAppsList(); updateActiveAppIcon(); }}function toggleMaximizeWindow(windowId) { const windowElement = document.getElementById(windowId); if (!windowElement) return; if (windowElement.classList.contains('window-maximized')) { restoreWindowSize(windowId); } else { maximizeWindow(windowId); } updateRunningAppsList();}function maximizeWindow(windowId) { const windowElement = document.getElementById(windowId); if (!windowElement) return; if (!windowOriginalStates.has(windowId)) { windowOriginalStates.set(windowId, { left: windowElement.style.left, top: windowElement.style.top, width: windowElement.style.width, height: windowElement.style.height, position: windowElement.style.position }); } windowElement.classList.add('window-maximized'); windowElement.style.resize = 'none'; const appWindow = appWindows.find(w => w.id === windowId); if (appWindow) { appWindow.isMaximized = true; appWindow.originalPosition = { ...appWindow.position }; appWindow.originalSize = { ...appWindow.size }; appWindow.position.x = 0; appWindow.position.y = 50; appWindow.size.width = windowElement.offsetWidth; appWindow.size.height = windowElement.offsetHeight; } bringWindowToFront(windowId);}function restoreWindowSize(windowId) { const windowElement = document.getElementById(windowId); if (!windowElement) return; windowElement.classList.remove('window-maximized'); const originalState = windowOriginalStates.get(windowId); if (originalState) { windowElement.style.left = originalState.left; windowElement.style.top = originalState.top; windowElement.style.width = originalState.width; windowElement.style.height = originalState.height; windowElement.style.position = originalState.position; windowElement.style.resize = 'both'; windowOriginalStates.delete(windowId); } else { windowElement.style.left = '100px'; windowElement.style.top = '100px'; windowElement.style.width = '800px'; windowElement.style.height = '600px'; windowElement.style.position = 'absolute'; windowElement.style.resize = 'both'; } const appWindow = appWindows.find(w => w.id === windowId); if (appWindow) { appWindow.isMaximized = false; if (appWindow.originalPosition) { appWindow.position = { ...appWindow.originalPosition }; } if (appWindow.originalSize) { appWindow.size = { ...appWindow.originalSize }; } } bringWindowToFront(windowId);}let allWindows = [];let globalZIndex = 100;function bringWindowToFront(windowId) { const windowElement = document.getElementById(windowId); if (!windowElement) return; globalZIndex++; windowElement.style.zIndex = globalZIndex; setActiveWindow(windowId); updateActiveAppIcon();}function setActiveWindow(windowId) { document.querySelectorAll('.folder-window, .app-window').forEach(w => { w.classList.remove('window-active'); }); const targetWindow = document.getElementById(windowId); if (targetWindow) { targetWindow.classList.add('window-active'); }}function registerWindow(windowElement) { const windowId = windowElement.id; unregisterWindow(windowId); allWindows.push({ id: windowId, element: windowElement, type: windowElement.classList.contains('app-window') ? 'app' : 'folder' }); bringWindowToFront(windowId); setTimeout(updateRunningAppsList, 100);}function unregisterWindow(windowId) { allWindows = allWindows.filter(w => w.id !== windowId); setTimeout(updateRunningAppsList, 100);}let clockInterval;let currentActiveApp = null;let isMouseDownOnClock = false;const folderIconBase64 = 'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImZvbGRlckdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRkI3NEQ7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojRkY5ODAwO3N0b3Atb3BhY2l0eToxIiAvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHg9IjIiIHk9IjIiIHdpZHRoPSIyOCIgaGVpZ2h0PSIyOCIgcng9IjYiIGZpbGw9InVybCgjZm9sZGVyR3JhZCkiLz48cGF0aCBkPSJNNiAxMmgydjE2SDZ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTYgOGg4bDIgNGgxMiIgZmlsbD0iI0ZGRTBCMiIvPjwvc3ZnPg==';function updateClock() { if (isMouseDownOnClock) return; const now = new Date(); let hours = now.getHours(); const minutes = now.getMinutes().toString().padStart(2, '0'); if (systemConfig.datetime.timeFormat === '12') { const ampm = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12 || 12; document.getElementById('clock-display').textContent = `${hours}:${minutes} ${ampm}`; } else { document.getElementById('clock-display').textContent = `${hours}:${minutes}`; }}function showDateOnClick() { isMouseDownOnClock = true; const now = new Date(); const dateString = now.toLocaleDateString('es-ES'); const clockElement = document.getElementById('clock-display'); if (clockElement) { clockElement.textContent = dateString; } document.addEventListener('mouseup', function restoreClock() { isMouseDownOnClock = false; updateClock(); document.removeEventListener('mouseup', restoreClock); }); document.addEventListener('touchend', function restoreClockTouch() { isMouseDownOnClock = false; updateClock(); document.removeEventListener('touchend', restoreClockTouch); });}function updateRunningAppsList() { const runningAppsList = document.getElementById('running-apps-list'); if (!runningAppsList) return; runningAppsList.innerHTML = ''; console.log("Actualizando lista de aplicaciones..."); console.log("appWindows:", appWindows.length, "allWindows:", allWindows.length); appWindows = appWindows.filter(appWindow => { const windowElement = document.getElementById(appWindow.id); const exists = windowElement !== null; if (!exists) { console.log("Filtrado: Ventana no existe en DOM:", appWindow.id); } return exists; }); appWindows.forEach(appWindow => { console.log("Agregando app a la lista:", appWindow.id, appWindow.title); const appItem = document.createElement('a'); appItem.href = '#'; appItem.onclick = (e) => { e.preventDefault(); switchToApp(appWindow.id); }; let statusIndicator = ''; if (appWindow.isMinimized) { statusIndicator = ' (Minimizada)'; } else if (appWindow.isMaximized) { statusIndicator = ' (Maximizada)'; } let appIcon = appWindow.icon; if (!appIcon || appIcon === 'null' || appIcon === 'undefined') { appIcon = 'data:image/svg+xml;base64,' + btoa(genericExecutableIcon); } appItem.innerHTML = ` <img src="${appIcon}" alt="${appWindow.title}" width="16" height="16" onerror="this.src='data:image/svg+xml;base64,${btoa(genericExecutableIcon)}'"><span>${appWindow.title}${statusIndicator}</span> `; runningAppsList.appendChild(appItem); }); allWindows.forEach(window => { if (window.element && window.element.classList.contains('folder-window') && !window.element.classList.contains('app-window') && window.element.id !== 'trash-window' && window.element.id !== 'help-window') { const folderTitle = window.element.querySelector('.folder-title'); if (folderTitle) { const folderName = folderTitle.textContent.trim(); const folderIcon = folderTitle.querySelector('img'); const isMinimized = window.element.classList.contains('window-minimized'); const isMaximized = window.element.classList.contains('window-maximized'); let statusIndicator = ''; if (isMinimized) { statusIndicator = ' (Minimizada)'; } else if (isMaximized) { statusIndicator = ' (Maximizada)'; } const folderItem = document.createElement('a'); folderItem.href = '#'; folderItem.onclick = (e) => { e.preventDefault(); switchToApp(window.id); }; const iconSrc = folderIcon ? folderIcon.src : 'data:image/svg+xml;base64,' + btoa(folderIcon); folderItem.innerHTML = ` <img src="${iconSrc}" alt="${folderName}" width="16" height="16" onerror="this.src='data:image/svg+xml;base64,${btoa(folderIcon)}'"><span>${folderName}${statusIndicator}</span> `; runningAppsList.appendChild(folderItem); } } }); if (runningAppsList.children.length === 0) { const noAppsItem = document.createElement('a'); noAppsItem.innerHTML = `<span style="color: #666; font-style: italic;">No hay aplicaciones en ejecuci√≥n</span>`; noAppsItem.style.pointerEvents = 'none'; runningAppsList.appendChild(noAppsItem); } console.log("Lista actualizada. Elementos en lista:", runningAppsList.children.length);}function updateActiveAppIcon() { const activeWindow = getActiveWindow(); const appIconElement = document.getElementById('current-app-icon'); if (activeWindow && activeWindow.element) { const windowIcon = activeWindow.element.querySelector('.folder-title img'); if (windowIcon && windowIcon.src) { appIconElement.src = windowIcon.src; currentActiveApp = activeWindow.id; } else { appIconElement.src = 'data:image/svg+xml;base64,' + btoa(genericExecutableIcon); currentActiveApp = activeWindow.id; } } else { appIconElement.src = 'data:image/svg+xml;base64,' + folderIconBase64; currentActiveApp = null; }}function getActiveWindow() { let highestZIndex = -1; let activeWindow = null; appWindows.forEach(appWindow => { const windowElement = document.getElementById(appWindow.id); if (windowElement && windowElement.style.display !== 'none' && !windowElement.classList.contains('window-minimized')) { const zIndex = parseInt(windowElement.style.zIndex) || 0; if (zIndex > highestZIndex) { highestZIndex = zIndex; activeWindow = { id: appWindow.id, element: windowElement, type: 'app' }; } } }); allWindows.forEach(window => { const windowElement = document.getElementById(window.id); if (windowElement && windowElement.style.display !== 'none' && !windowElement.classList.contains('window-minimized')) { const zIndex = parseInt(windowElement.style.zIndex) || 0; if (zIndex > highestZIndex) { highestZIndex = zIndex; activeWindow = window; } } }); return activeWindow;}function switchToApp(appId) { const appWindow = appWindows.find(w => w.id === appId); const windowElement = document.getElementById(appId); if (windowElement) { if (windowElement.classList.contains('window-minimized')) { restoreWindow(appId); } else { bringWindowToFront(appId); } closeAllMenus(); } else if (appWindow) { renderAppWindow(appWindow); bringWindowToFront(appId); closeAllMenus(); }}function hideCurrentApp() { if (currentActiveApp) { minimizeWindow(currentActiveApp); } closeAllMenus();}function hideOtherApps() { const activeApp = getActiveWindow(); allWindows.forEach(window => { if (window.id !== activeApp.id && !window.element.classList.contains('window-minimized')) { minimizeWindow(window.id); } }); appWindows.forEach(appWindow => { if (appWindow.id !== activeApp.id && !appWindow.isMinimized) { minimizeWindow(appWindow.id); } }); closeAllMenus();}function showAllApps() { allWindows.forEach(window => { if (window.element.classList.contains('window-minimized')) { restoreWindow(window.id); } }); appWindows.forEach(appWindow => { if (appWindow.isMinimized) { restoreWindow(appWindow.id); } }); closeAllMenus();}let appData = { shortcuts: [], folders: [], trash: [], settings: { view: 'icons' }};let draggedShortcut = null;let draggedFolder = null;let currentWizardStep = 1;let wizardData = {};let currentWebWizardStep = 1;let webWizardData = {};let urlType = 'web';let pendingAction = null;let clipboard = { type: null, items: [], sourceFolder: null};let selectedItems = new Set();let undoStack = [];let appWindows = [];const genericExecutableIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#60cdff;stop-opacity:1" /><stop offset="100%" style="stop-color:#0078d4;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#grad)"/><rect x="7" y="7" width="18" height="18" rx="4" fill="#ffffff"/><path d="M14 11v10M18 11v10M10 15h12" stroke="#0078d4" stroke-width="2" stroke-linecap="round"/></svg>`;const discoLocalIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="diskGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" /><stop offset="100%" style="stop-color:#ffa500;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#diskGrad)"/><rect x="6" y="6" width="20" height="20" rx="3" fill="#ffffff"/><rect x="9" y="9" width="14" height="3" rx="1" fill="#ffa500"/><rect x="9" y="14" width="14" height="3" rx="1" fill="#ffa500"/><rect x="9" y="19" width="14" height="3" rx="1" fill="#ffa500"/></svg>`;const genericWebIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="webGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" /><stop offset="100%" style="stop-color:#2E7D32;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#webGrad)"/><circle cx="16" cy="16" r="8" fill="#ffffff"/><path d="M16 8c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8z" fill="none" stroke="#2E7D32" stroke-width="2"/><path d="M16 8v16M8 16h16" stroke="#2E7D32" stroke-width="2" stroke-linecap="round"/></svg>`;const folderIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="folderGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#FFB74D;stop-opacity:1" /><stop offset="100%" style="stop-color:#FF9800;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#folderGrad)"/><path d="M6 12h20v16H6z" fill="#ffffff"/><path d="M6 8h8l2 4h12" fill="#FFE0B2"/></svg>`;const trashEmptyIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="trashGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#78909C;stop-opacity:1" /><stop offset="100%" style="stop-color:#546E7A;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#trashGrad)"/><path d="M12 8h8v2h-8zM10 12h12v14H10z" fill="#ffffff"/><rect x="13" y="15" width="2" height="8" fill="#546E7A"/><rect x="17" y="15" width="2" height="8" fill="#546E7A"/></svg>`;const trashFullIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="48" height="48"><defs><linearGradient id="trashFullGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#EF5350;stop-opacity:1" /><stop offset="100%" style="stop-color:#D32F2F;stop-opacity:1" /></linearGradient></defs><rect x="2" y="2" width="28" height="28" rx="6" fill="url(#trashFullGrad)"/><path d="M12 8h8v2h-8zM10 12h12v14H10z" fill="#ffffff"/><rect x="13" y="15" width="2" height="8" fill="#D32F2F"/><rect x="17" y="15" width="2" height="8" fill="#D32F2F"/><circle cx="16" cy="20" r="6" fill="#FFCDD2" opacity="0.8"/></svg>`;function openApp(appName, url) { const appWindow = { name: appName, type: 'web', icon: 'data:image/svg+xml;base64,' + btoa(genericWebIcon) }; createAppWindow(appWindow, url, 'web'); closeAllMenus();}function openAboutWineBOX() { const windowId = generateId(); const appWindow = { id: windowId, title: "About this WineBOX", type: 'about', position: { x: 200, y: 150 }, size: { width: 600, height: 500 }, isMinimized: false, isMaximized: false, icon: 'data:image/svg+xml;base64,' + btoa(genericWebIcon) }; appWindows.push(appWindow); renderAboutWindow(appWindow); closeAllMenus();}function renderAboutWindow(appWindow) { const windowElement = document.createElement('div'); windowElement.className = 'folder-window app-window'; windowElement.id = appWindow.id; windowElement.style.display = 'flex'; windowElement.style.left = appWindow.position.x + 'px'; windowElement.style.top = appWindow.position.y + 'px'; windowElement.style.width = appWindow.size.width + 'px'; windowElement.style.height = appWindow.size.height + 'px'; const systemInfo = getSystemInfo(); windowElement.innerHTML = ` <div class="folder-header"><div class="folder-title"><img src="${appWindow.icon}" alt="${appWindow.title}" width="16" height="16"> ${appWindow.title} </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${appWindow.id}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${appWindow.id}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeAppWindow('${appWindow.id}')" title="Cerrar"></button></div></div><div class="folder-scroll-container" style="background: white;"><div class="folder-scroll-area" style="padding: 20px;"><div class="help-content"><div class="help-header"><h1>WineBOX v1.73</h1><p class="version-info">Program Manager - Sistema de Ventanas Mejorado</p></div><div class="help-section"><h2>üìã ¬øQu√© es WineBOX?</h2><p>WineBOX es un entorno de escritorio virtual que emula la experiencia de Windows 11 en el navegador. Proporciona un sistema de ventanas, aplicaciones y un administrador de programas similar al sistema operativo Windows.</p></div><div class="help-section"><h2>‚öôÔ∏è Informaci√≥n del Sistema</h2><div style="background: #f5f5f5; padding: 15px; border-radius: 8px;"><p><strong>Navegador:</strong> ${systemInfo.browser}</p><p><strong>Plataforma:</strong> ${systemInfo.platform}</p><p><strong>Idioma:</strong> ${systemInfo.language}</p><p><strong>Memoria:</strong> ${systemInfo.memory}</p><p><strong>N√∫cleos de CPU:</strong> ${systemInfo.cores}</p><p><strong>Resoluci√≥n:</strong> ${systemInfo.resolution}</p><p><strong>User Agent:</strong> ${systemInfo.userAgent}</p></div></div><div class="help-section"><h2>üöÄ Caracter√≠sticas del Program Manager</h2><ul><li>Sistema de ventanas con minimizar, maximizar y cerrar</li><li>Administrador de aplicaciones en ejecuci√≥n</li><li>Sistema de archivos virtual con carpetas</li><li>Papelera de reciclaje</li><li>Instalaci√≥n de aplicaciones ZIP</li><li>Accesos directos web y HTML</li><li>Sistema completo de paneles de control</li></ul></div><div class="help-footer"><p>WineBOX v1.73 - Program Manager</p><p>Compatibilidad: Chrome, Firefox, Edge, Safari</p></div></div></div></div> `; document.querySelector('.program-manager').appendChild(windowElement); registerWindow(windowElement); makeAppWindowDraggable(windowElement, appWindow); makeAppWindowResizable(windowElement, appWindow); windowElement.addEventListener('mousedown', () => { bringWindowToFront(appWindow.id); }); return windowElement;}function getSystemInfo() { const info = { browser: 'Desconocido', platform: 'Desconocido', language: navigator.language || 'Desconocido', memory: 'No disponible', cores: navigator.hardwareConcurrency || 'Desconocido', resolution: `${window.screen.width}x${window.screen.height}`, userAgent: navigator.userAgent }; if (navigator.userAgent.indexOf("Chrome") !== -1) { info.browser = "Google Chrome"; } else if (navigator.userAgent.indexOf("Firefox") !== -1) { info.browser = "Mozilla Firefox"; } else if (navigator.userAgent.indexOf("Safari") !== -1) { info.browser = "Apple Safari"; } else if (navigator.userAgent.indexOf("Edge") !== -1) { info.browser = "Microsoft Edge"; } if (navigator.platform.indexOf("Win") !== -1) { info.platform = "Windows"; } else if (navigator.platform.indexOf("Mac") !== -1) { info.platform = "macOS"; } else if (navigator.platform.indexOf("Linux") !== -1) { info.platform = "Linux"; } if (performance.memory) { const memory = performance.memory; const usedMB = Math.round(memory.usedJSHeapSize / 1048576); const totalMB = Math.round(memory.totalJSHeapSize / 1048576); info.memory = `${usedMB} MB / ${totalMB} MB`; } return info;}function shutdown() { showConfirm('Shutdown', '¬øEst√°s seguro de que quieres apagar el sistema?', () => { window.location.href = 'https://winebox.cloud/src/redirects/shutdown/logoff.html'; }); closeAllMenus();}function createAppWindow(appData, contentUrl, windowType = 'app') { const windowId = generateId(); const appWindow = { id: windowId, title: appData.name || 'Aplicaci√≥n', type: windowType, contentUrl: contentUrl, position: { x: 100 + appWindows.length * 30, y: 100 + appWindows.length * 30 }, size: { width: 800, height: 600 }, isMinimized: false, isMaximized: false, originalSize: { width: 800, height: 600 }, originalPosition: { x: 100 + appWindows.length * 30, y: 100 + appWindows.length * 30 }, created: new Date().toISOString(), icon: appData.icon || 'data:image/svg+xml;base64,' + btoa(genericExecutableIcon) }; appWindows.push(appWindow); renderAppWindow(appWindow); return windowId;}function renderAppWindow(appWindow) { const windowElement = document.createElement('div'); windowElement.className = 'folder-window app-window'; windowElement.id = appWindow.id; windowElement.style.display = 'flex'; windowElement.style.left = appWindow.position.x + 'px'; windowElement.style.top = appWindow.position.y + 'px'; windowElement.style.width = appWindow.size.width + 'px'; windowElement.style.height = appWindow.size.height + 'px'; let contentHTML = ''; if (appWindow.type === 'web' || appWindow.type === 'html') { contentHTML = ` <iframe src="${appWindow.contentUrl}" style="width: 100%; height: 100%; border: none;" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe> `; } else if (appWindow.type === 'zip') { contentHTML = ` <iframe src="${appWindow.contentUrl}" style="width: 100%; height: 100%; border: none;"></iframe> `; } else { contentHTML = ` <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: white;"><p>Cargando aplicaci√≥n: ${appWindow.title}</p></div> `; } windowElement.innerHTML = ` <div class="folder-header"><div class="folder-title"><img src="${appWindow.icon}" alt="${appWindow.title}" width="16" height="16"> ${appWindow.title} </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${appWindow.id}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${appWindow.id}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeAppWindow('${appWindow.id}')" title="Cerrar"></button></div></div><div class="folder-scroll-container" style="background: white;"><div class="folder-scroll-area" style="background: white;"> ${contentHTML} </div></div> `; document.querySelector('.program-manager').appendChild(windowElement); registerWindow(windowElement); if (!appWindow.isMaximized) { makeAppWindowDraggable(windowElement, appWindow); makeAppWindowResizable(windowElement, appWindow); } windowElement.addEventListener('mousedown', () => { bringWindowToFront(appWindow.id); }); return windowElement;}function makeAppWindowDraggable(element, appWindow) { const header = element.querySelector('.folder-header'); let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; header.onmousedown = dragMouseDown; function dragMouseDown(e) { e = e || window.event; e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; document.onmouseup = closeDragElement; document.onmousemove = elementDrag; bringWindowToFront(appWindow.id); } function elementDrag(e) { e = e || window.event; e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY; const newX = element.offsetLeft - pos1; const newY = element.offsetTop - pos2; element.style.left = newX + "px"; element.style.top = newY + "px"; appWindow.position.x = newX; appWindow.position.y = newY; } function closeDragElement() { document.onmouseup = null; document.onmousemove = null; }}function makeAppWindowResizable(element, appWindow) { const resizeHandle = document.createElement('div'); resizeHandle.style.width = '20px'; resizeHandle.style.height = '20px'; resizeHandle.style.background = 'transparent'; resizeHandle.style.position = 'absolute'; resizeHandle.style.right = '0'; resizeHandle.style.bottom = '0'; resizeHandle.style.cursor = 'se-resize'; element.appendChild(resizeHandle); resizeHandle.onmousedown = function(e) { e.preventDefault(); document.onmousemove = resizeElement; document.onmouseup = stopResize; bringWindowToFront(appWindow.id); }; function resizeElement(e) { const newWidth = Math.max(400, e.clientX - element.offsetLeft); const newHeight = Math.max(300, e.clientY - element.offsetTop); element.style.width = newWidth + 'px'; element.style.height = newHeight + 'px'; appWindow.size.width = newWidth; appWindow.size.height = newHeight; const iframe = element.querySelector('iframe'); if (iframe) { iframe.style.width = '100%'; iframe.style.height = '100%'; } } function stopResize() { document.onmousemove = null; document.onmouseup = null; }}function closeAppWindow(windowId) { console.log("Cerrando ventana:", windowId); const windowElement = document.getElementById(windowId); if (windowElement) { windowElement.remove(); } windowOriginalStates.delete(windowId); appWindows = appWindows.filter(w => { if (w.id === windowId) { console.log("Eliminando ventana de appWindows:", windowId); return false; } return true; }); allWindows = allWindows.filter(w => { if (w.id === windowId) { console.log("Eliminando ventana de allWindows:", windowId); return false; } return true; }); unregisterWindow(windowId); setTimeout(() => { updateActiveAppIcon(); updateRunningAppsList(); cleanupGhostWindows(); }, 100); console.log("Ventana cerrada. appWindows restantes:", appWindows.length);}function closeControlPanel(windowId) { console.log("Cerrando panel de control:", windowId); const windowElement = document.getElementById(windowId); if (windowElement) { if (windowElement.updateInterval) { clearInterval(windowElement.updateInterval); } windowElement.remove(); } appWindows = appWindows.filter(w => w.id !== windowId); allWindows = allWindows.filter(w => w.id !== windowId); windowOriginalStates.delete(windowId); setTimeout(() => { updateRunningAppsList(); updateActiveAppIcon(); }, 100);}function createFolderWindow(folder) { const folderWindow = document.createElement('div'); folderWindow.className = 'folder-window'; folderWindow.id = folder.id; folderWindow.style.display = 'none'; folderWindow.style.left = folder.position.x + 'px'; folderWindow.style.top = folder.position.y + 'px'; folderWindow.style.width = folder.size.width + 'px'; folderWindow.style.height = folder.size.height + 'px'; const folderItems = getAllItemsInLocation(`folder:${folder.id}`); let folderIconsHTML = ''; if (folderItems.length === 0) { folderIconsHTML = '<div class="folder-empty">Esta carpeta est√° vac√≠a</div>'; } else { folderItems.forEach(item => { const element = document.createElement('div'); element.className = item.type === 'folder' ? 'folder-shortcut folder-item' : 'folder-shortcut'; element.draggable = true; element.setAttribute('data-id', item.id); element.setAttribute('data-type', item.type); let content = ''; if (appData.settings.view === 'list') { content = `<div class="folder-shortcut-name">${item.name}</div>`; } else if (appData.settings.view === 'dates') { const date = new Date(item.data.created).toLocaleDateString(); content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div><div class="folder-shortcut-date">${date}</div> `; } else { content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div> `; } element.innerHTML = content; folderIconsHTML += element.outerHTML; }); } folderWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><img src="data:image/svg+xml;base64,${btoa(folderIcon)}" alt="Folder" width="16" height="16"> ${folder.name} <span class="folder-item-count">(${folderItems.length} elementos)</span></div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('${folder.id}')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('${folder.id}')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeFolder('${folder.id}')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area" id="${folder.id}-scroll-area"><div class="folder-icons-container folder-view-${appData.settings.view}" id="${folder.id}-content"> ${folderIconsHTML} </div></div></div> `; document.querySelector('.program-manager').appendChild(folderWindow); registerWindow(folderWindow); setTimeout(() => { setupFolderContentEvents(folderWindow, folder); }, 0); makeDraggable(folderWindow, folder); makeResizable(folderWindow, folder); setupFolderWindowDropZone(folderWindow, folder); return folderWindow;}function openFolder(folderId) { const folder = getFolderById(folderId); if (folder) { const folderWindow = document.getElementById(folderId); if (folderWindow) { folderWindow.style.display = 'flex'; bringWindowToFront(folderId); } else { createFolderWindow(folder); const newFolderWindow = document.getElementById(folderId); if (newFolderWindow) { newFolderWindow.style.display = 'flex'; bringWindowToFront(folderId); } } }}function openWebFrame(url, shortcutData) { const appWindow = { name: shortcutData.name || 'Aplicaci√≥n Web', type: 'web', icon: shortcutData.icon || 'data:image/svg+xml;base64,' + btoa(genericWebIcon) }; createAppWindow(appWindow, url, 'web');}function openLocalHTML(file, shortcutData) { const appWindow = { name: shortcutData.name || 'Documento HTML', type: 'html', icon: shortcutData.icon || 'data:image/svg+xml;base64,' + btoa(genericWebIcon) }; const fileURL = URL.createObjectURL(file); createAppWindow(appWindow, fileURL, 'html');}document.addEventListener('mousedown', function(e) { const windowElement = e.target.closest('.folder-window, .app-window'); if (windowElement) { bringWindowToFront(windowElement.id); }});function toggleMenu(menuId) { const menu = document.getElementById(menuId); const isVisible = menu.style.display === 'block'; closeAllMenus(); if (!isVisible) { menu.style.display = 'block'; }}function saveAllData() { localStorage.setItem('programManagerData', JSON.stringify(appData));}function loadAllData() { const savedData = localStorage.getItem('programManagerData'); if (savedData) { appData = JSON.parse(savedData); } else { initializeDefaultData(); }}function initializeDefaultData() { appData = { shortcuts: [ { id: generateId(), name: "Disco local", icon: 'data:image/svg+xml;base64,' + btoa(discoLocalIcon), isDiscoLocal: true, created: new Date().toISOString(), location: 'desktop' }, { id: generateId(), name: "Papelera", icon: 'data:image/svg+xml;base64,' + btoa(trashEmptyIcon), isTrash: true, created: new Date().toISOString(), location: 'desktop' } ], folders: [], trash: [], settings: { view: 'icons' } };}function generateId() { return Date.now().toString(36) + Math.random().toString(36).substr(2);}function renderShortcuts() { const container = document.getElementById('shortcuts-container'); container.innerHTML = ''; const systemShortcuts = appData.shortcuts.filter(shortcut => shortcut.isDiscoLocal || shortcut.isTrash ); systemShortcuts.forEach(shortcut => { if ((shortcut.isDiscoLocal && systemConfig.desktop.showDiscoLocal) || (shortcut.isTrash && systemConfig.desktop.showTrash)) { const shortcutElement = createShortcutElement(shortcut, shortcut.id); container.appendChild(shortcutElement); } }); const desktopItems = getAllItemsInLocation('desktop'); desktopItems.forEach(item => { let shortcutElement; if (item.type === 'folder') { shortcutElement = createShortcutElement({ id: item.id, name: item.name, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), isFolder: true, folderId: item.id, created: item.data.created, isFolderShortcut: true }, item.id); } else { const shortcut = getShortcutById(item.id); if (shortcut) { shortcutElement = createShortcutElement(shortcut, shortcut.id); } } if (shortcutElement) { container.appendChild(shortcutElement); } });}function createShortcutElement(shortcut, shortcutId) { const shortcutElement = document.createElement('div'); shortcutElement.className = 'shortcut'; shortcutElement.draggable = !shortcut.isDiscoLocal; shortcutElement.setAttribute('data-id', shortcutId); let content = ''; if (appData.settings.view === 'list') { content = `<div class="shortcut-name">${shortcut.name}</div>`; } else if (appData.settings.view === 'dates') { const date = new Date(shortcut.created).toLocaleDateString(); content = ` <img src="${shortcut.icon}" alt="${shortcut.name} icon"><div class="shortcut-name">${shortcut.name}</div><div class="shortcut-date">${date}</div> `; } else { content = ` <img src="${shortcut.icon}" alt="${shortcut.name} icon"><div class="shortcut-name">${shortcut.name}</div> `; } shortcutElement.innerHTML = content; if (shortcut.isDiscoLocal) { shortcutElement.addEventListener('click', openDiscoLocal); } else if (shortcut.isTrash) { shortcutElement.addEventListener('click', openTrash); setupTrashDropEvents(shortcutElement); } else if (shortcut.isFolder) { shortcutElement.addEventListener('click', () => openFolder(shortcut.folderId)); setupFolderDragEvents(shortcutElement, shortcutId); } else { shortcutElement.addEventListener('click', function(e) { if (!e.ctrlKey && selectedItems.size === 0) { if (shortcut.type === 'zip') { openFrame(shortcut.zip ? shortcut.zip.replace('.zip', '') : 'app'); } else if (shortcut.type === 'web') { openWebFrame(shortcut.url, shortcut); } else if (shortcut.type === 'html') { openLocalHTML(shortcut.fileObject, shortcut); } } }); setupShortcutDragEvents(shortcutElement, shortcutId); } shortcutElement.addEventListener('click', (e) => { if (e.ctrlKey && !shortcut.isDiscoLocal && !shortcut.isTrash) { e.preventDefault(); toggleSelection(shortcutElement, shortcutId, 'shortcut'); } }); setupDropEvents(shortcutElement, shortcutId); return shortcutElement;}function createNewFolder() { document.getElementById('new-folder-modal').style.display = 'block'; document.getElementById('folder-name').value = ''; closeAllMenus();}function createFolder() { const folderName = document.getElementById('folder-name').value.trim(); if (!folderName) { showMessage('Error', 'Por favor, ingrese un nombre para la carpeta.'); return; } saveUndoState(); const folder = { id: generateId(), name: folderName, position: { x: 100 + appData.folders.length * 30, y: 100 + appData.folders.length * 30 }, size: { width: 500, height: 400 }, created: new Date().toISOString(), parentId: null, isFolderShortcut: false }; appData.folders.push(folder); appData.shortcuts.push({ id: generateId(), name: folderName, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), isFolder: true, folderId: folder.id, created: new Date().toISOString(), location: 'desktop', isFolderShortcut: true }); saveAllData(); renderShortcuts(); closeModal('new-folder-modal');}function renderFolders() { const openFolders = new Map(); document.querySelectorAll('.folder-window:not(#trash-window):not(#help-window)').forEach(el => { if (el.style.display !== 'none') { const scrollArea = el.querySelector('.folder-scroll-area'); if (scrollArea) { openFolders.set(el.id, { scrollTop: scrollArea.scrollTop, scrollLeft: scrollArea.scrollLeft, isOpen: true }); } } }); document.querySelectorAll('.folder-window:not(#trash-window):not(#help-window)').forEach(el => el.remove()); appData.folders.forEach(folder => { createFolderWindow(folder); if (openFolders.has(folder.id)) { const folderData = openFolders.get(folder.id); const folderWindow = document.getElementById(folder.id); if (folderWindow && folderData.isOpen) { folderWindow.style.display = 'flex'; bringWindowToFront(folder.id); setTimeout(() => { const scrollArea = folderWindow.querySelector('.folder-scroll-area'); if (scrollArea) { if (folderData.scrollTop) { scrollArea.scrollTop = folderData.scrollTop; } if (folderData.scrollLeft) { scrollArea.scrollLeft = folderData.scrollLeft; } } }, 50); } } });}function openTrash() { let trashWindow = document.getElementById('trash-window'); if (!trashWindow) { createTrashWindow(); } else { trashWindow.style.display = 'flex'; bringWindowToFront('trash-window'); }}function createTrashWindow() { const trashWindow = document.createElement('div'); trashWindow.className = 'folder-window'; trashWindow.id = 'trash-window'; trashWindow.style.display = 'flex'; trashWindow.style.left = '150px'; trashWindow.style.top = '150px'; trashWindow.style.width = '500px'; trashWindow.style.height = '400px'; let trashContentHTML = ''; if (appData.trash.length === 0) { trashContentHTML = '<div class="folder-empty">La papelera est√° vac√≠a</div>'; } else { appData.trash.forEach((item, index) => { const element = document.createElement('div'); element.className = 'folder-shortcut'; element.draggable = true; element.setAttribute('data-trash-index', index); element.setAttribute('data-item-type', item.itemType); let content = ''; if (appData.settings.view === 'list') { content = `<div class="folder-shortcut-name">${item.name}</div>`; } else if (appData.settings.view === 'dates') { const deletedDate = new Date(item.deletedAt).toLocaleDateString(); content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div><div class="folder-shortcut-date">Eliminado: ${deletedDate}</div> `; } else { content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div> `; } element.innerHTML = content; trashContentHTML += element.outerHTML; }); } trashWindow.innerHTML = ` <div class="folder-header"><div class="folder-title"><img src="data:image/svg+xml;base64,${btoa(appData.trash.length > 0 ? trashFullIcon : trashEmptyIcon)}" alt="Papelera" width="16" height="16"> Papelera de Reciclaje (${appData.trash.length} elementos) </div><div class="folder-actions"><button class="folder-action-btn minimize-btn" onclick="minimizeWindow('trash-window')" title="Minimizar"></button><button class="folder-action-btn maximize-btn" onclick="toggleMaximizeWindow('trash-window')" title="Maximizar"></button><button class="folder-action-btn close-btn" onclick="closeFolder('trash-window')" title="Cerrar"></button></div></div><div class="folder-scroll-container"><div class="folder-scroll-area" id="trash-scroll-area"><div class="folder-icons-container folder-view-${appData.settings.view}" id="trash-content"> ${trashContentHTML} </div></div></div> `; document.querySelector('.program-manager').appendChild(trashWindow); registerWindow(trashWindow); setTimeout(() => { const trashContent = document.getElementById('trash-content'); if (trashContent) { const trashElements = trashContent.querySelectorAll('.folder-shortcut'); trashElements.forEach((element, index) => { element.addEventListener('click', function(e) { if (!e.ctrlKey) { restoreFromTrash(index); } }); element.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text/plain', 'trash:' + index); element.classList.add('dragging'); }); element.addEventListener('dragend', (e) => { element.classList.remove('dragging'); }); }); } }, 0); makeDraggable(trashWindow, { position: { x: 150, y: 150 }, size: { width: 500, height: 400 } }); makeResizable(trashWindow, { size: { width: 500, height: 400 } }); setupTrashWindowDropZone(trashWindow);}function closeAllMenus() { const menus = document.getElementsByClassName('menu-content'); for (let menu of menus) { menu.style.display = 'none'; } document.getElementById('running-apps-menu').style.display = 'none';}function closeAllWindows() { document.querySelectorAll('.folder-window').forEach(window => { window.style.display = 'none'; }); closeAllAppWindows(); closeAllMenus();}function closeAllAppWindows() { appWindows.forEach(appWindow => { closeAppWindow(appWindow.id); });}function emptyTrash() { if (appData.trash.length > 0) { showConfirm('Vaciar Papelera', '¬øEst√°s seguro de que quieres vaciar la papelera? Esta acci√≥n no se puede deshacer.', () => { saveUndoState(); appData.trash = []; updateTrashIcon(); saveAllData(); renderShortcuts(); renderFolders(); showMessage('Papelera vaciada', 'La papelera se ha vaciado correctamente.'); }); } else { showMessage('Papelera vac√≠a', 'La papelera ya est√° vac√≠a.'); } closeAllMenus();}function restartProgram() { showConfirm('Reiniciar Programa', '¬øEst√°s seguro de que quieres reiniciar el programa? Se cerrar√°n todas las ventanas.', () => { closeAllWindows(); renderShortcuts(); renderFolders(); showMessage('Programa reiniciado', 'El programa se ha reiniciado correctamente.'); }); closeAllMenus();}function clearAllData() { showConfirm('Borrar todos los datos', '¬øEst√°s seguro de que quieres eliminar TODOS los datos del programa? Esta acci√≥n eliminar√° todos los accesos directos, carpetas y elementos de la papelera. Esta acci√≥n NO se puede deshacer.', () => { localStorage.removeItem('programManagerData'); localStorage.removeItem('systemConfig'); appData = { shortcuts: [], folders: [], trash: [], settings: { view: 'icons' } }; selectedItems.clear(); undoStack = []; clipboard = { type: null, items: [], sourceFolder: null }; closeAllWindows(); initializeDefaultData(); loadSystemConfig(); renderShortcuts(); renderFolders(); showMessage('Datos eliminados', 'Todos los datos del programa han sido eliminados correctamente. El programa se ha reiniciado.'); }); closeAllMenus();}function changeView(viewType) { appData.settings.view = viewType; const container = document.getElementById('shortcuts-container'); container.classList.remove('view-icons', 'view-small-icons', 'view-list', 'view-dates'); container.classList.add('view-' + viewType); saveAllData(); renderShortcuts(); renderFolders(); closeAllMenus();}function openInstallWizard() { document.getElementById('install-modal').style.display = 'block'; resetWizard(); closeAllMenus();}function openNewShortcutWizard() { document.getElementById('new-shortcut-modal').style.display = 'block'; resetWebWizard(); closeAllMenus();}function openUninstallModal() { document.getElementById('uninstall-modal').style.display = 'block'; closeAllMenus(); populateUninstallSelect();}function openExecuteModal() { document.getElementById('execute-modal').style.display = 'block'; closeAllMenus();}function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; if (modalId === 'install-modal') { resetWizard(); } else if (modalId === 'new-shortcut-modal') { resetWebWizard(); }}function resetWizard() { currentWizardStep = 1; wizardData = {}; document.getElementById('zip-file').value = ''; document.getElementById('shortcut-name').value = ''; document.getElementById('shortcut-icon').value = ''; document.getElementById('icon-warning').style.display = 'none'; showWizardStep(1);}function resetWebWizard() { currentWebWizardStep = 1; webWizardData = {}; urlType = 'web'; document.getElementById('web-url').value = ''; document.getElementById('html-file').value = ''; document.getElementById('web-shortcut-name').value = ''; document.getElementById('web-shortcut-icon').value = ''; document.getElementById('web-icon-warning').style.display = 'none'; document.getElementById('web-url-btn').classList.add('active'); document.getElementById('html-file-btn').classList.remove('active'); document.getElementById('web-url-input').style.display = 'block'; document.getElementById('html-file-input').style.display = 'none'; showWebWizardStep(1);}function showWizardStep(step) { document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active')); document.getElementById(`wizard-step-${step}`).classList.add('active');}function showWebWizardStep(step) { document.querySelectorAll('.wizard-step').forEach(el => el.classList.remove('active')); document.getElementById(`web-wizard-step-${step}`).classList.add('active');}function setUrlType(type) { urlType = type; if (type === 'web') { document.getElementById('web-url-btn').classList.add('active'); document.getElementById('html-file-btn').classList.remove('active'); document.getElementById('web-url-input').style.display = 'block'; document.getElementById('html-file-input').style.display = 'none'; } else { document.getElementById('web-url-btn').classList.remove('active'); document.getElementById('html-file-btn').classList.add('active'); document.getElementById('web-url-input').style.display = 'none'; document.getElementById('html-file-input').style.display = 'block'; }}function nextStep(currentStep) { if (currentStep === 1) { const zipFile = document.getElementById('zip-file').files[0]; if (!zipFile) { showMessage('Error', 'Por favor, seleccione un archivo ZIP.'); return; } wizardData.zipFile = zipFile; } else if (currentStep === 2) { const shortcutName = document.getElementById('shortcut-name').value.trim(); if (!shortcutName) { showMessage('Error', 'Por favor, ingrese un nombre para el acceso directo.'); return; } wizardData.shortcutName = shortcutName; } currentWizardStep++; showWizardStep(currentWizardStep); if (currentWizardStep === 3) { document.getElementById('icon-warning').style.display = 'none'; }}function nextWebStep(currentStep) { if (currentStep === 1) { if (urlType === 'web') { const webUrl = document.getElementById('web-url').value.trim(); if (!webUrl) { showMessage('Error', 'Por favor, ingrese una direcci√≥n web.'); return; } try { new URL(webUrl); } catch (e) { showMessage('Error', 'Por favor, ingrese una direcci√≥n web v√°lida (ej: https://ejemplo.com).'); return; } webWizardData.url = webUrl; webWizardData.type = 'web'; } else { const htmlFile = document.getElementById('html-file').files[0]; if (!htmlFile) { showMessage('Error', 'Por favor, seleccione un archivo HTML.'); return; } webWizardData.file = htmlFile; webWizardData.type = 'html'; } } else if (currentStep === 2) { const shortcutName = document.getElementById('web-shortcut-name').value.trim(); if (!shortcutName) { showMessage('Error', 'Por favor, ingrese un nombre para el acceso directo.'); return; } webWizardData.shortcutName = shortcutName; } currentWebWizardStep++; showWebWizardStep(currentWebWizardStep); if (currentWebWizardStep === 3) { document.getElementById('web-icon-warning').style.display = 'none'; }}function prevStep(currentStep) { currentWizardStep--; showWizardStep(currentWizardStep);}function prevWebStep(currentStep) { currentWebWizardStep--; showWebWizardStep(currentWebWizardStep);}function finishInstallation() { const shortcutIcon = document.getElementById('shortcut-icon').files[0]; if (!shortcutIcon) { document.getElementById('icon-warning').style.display = 'block'; } wizardData.shortcutIcon = shortcutIcon || 'data:image/svg+xml;base64,' + btoa(genericExecutableIcon); saveUndoState(); const shortcut = { id: generateId(), name: wizardData.shortcutName, zip: wizardData.zipFile.name, icon: wizardData.shortcutIcon instanceof File ? URL.createObjectURL(wizardData.shortcutIcon) : wizardData.shortcutIcon, type: 'zip', created: new Date().toISOString(), location: 'desktop' }; appData.shortcuts.push(shortcut); saveAllData(); renderShortcuts(); renderFolders(); closeModal('install-modal');}function finishWebShortcut() { const shortcutIcon = document.getElementById('web-shortcut-icon').files[0]; if (!shortcutIcon) { document.getElementById('web-icon-warning').style.display = 'block'; } webWizardData.shortcutIcon = shortcutIcon || 'data:image/svg+xml;base64,' + btoa(genericWebIcon); saveUndoState(); const shortcut = { id: generateId(), name: webWizardData.shortcutName, icon: webWizardData.shortcutIcon instanceof File ? URL.createObjectURL(webWizardData.shortcutIcon) : webWizardData.shortcutIcon, type: webWizardData.type, created: new Date().toISOString(), location: 'desktop' }; if (webWizardData.type === 'web') { shortcut.url = webWizardData.url; } else { shortcut.file = webWizardData.file.name; shortcut.fileObject = webWizardData.file; } appData.shortcuts.push(shortcut); saveAllData(); renderShortcuts(); renderFolders(); closeModal('new-shortcut-modal');}function populateUninstallSelect() { const select = document.getElementById('uninstall-select'); select.innerHTML = ''; appData.shortcuts.forEach((shortcut) => { if (shortcut.name !== "Disco local" && !shortcut.isFolder && !shortcut.isTrash && !isInTrash(shortcut.id)) { const option = document.createElement('option'); option.value = shortcut.id; option.textContent = shortcut.name; select.appendChild(option); } });}function uninstallShortcut() { const select = document.getElementById('uninstall-select'); const shortcutId = select.value; if (shortcutId !== '') { saveUndoState(); moveToTrash(shortcutId); closeModal('uninstall-modal'); } else { showMessage('Error', 'Por favor, seleccione un acceso directo para desinstalar.'); }}function executeZip() { const zipFile = document.getElementById('execute-file').files[0]; if (zipFile) { const zipName = zipFile.name.replace('.zip', ''); openFrame(zipName); closeModal('execute-modal'); } else { showMessage('Error', 'Por favor, seleccione un archivo ZIP.'); }}function undoAction() { if (undoStack.length === 0) { showMessage('Informaci√≥n', 'No hay acciones para deshacer.'); return; } const previousState = undoStack.pop(); appData = previousState; saveAllData(); renderShortcuts(); renderFolders(); showMessage('Informaci√≥n', 'Acci√≥n deshecha correctamente.'); closeAllMenus();}function cutSelection() { if (selectedItems.size === 0) { showMessage('Informaci√≥n', 'No hay elementos seleccionados para cortar.'); return; } clipboard.type = 'cut'; clipboard.items = Array.from(selectedItems); clipboard.sourceFolder = getCurrentFolderContext(); showMessage('Informaci√≥n', `${selectedItems.size} elemento(s) marcado(s) para cortar.`); closeAllMenus();}function pasteSelection() { if (clipboard.items.length === 0) { showMessage('Informaci√≥n', 'No hay elementos en el portapapeles para pegar.'); return; } const targetFolder = getCurrentFolderContext(); saveUndoState(); clipboard.items.forEach(itemKey => { const [type, id] = itemKey.split(':'); if (type === 'shortcut' || type === 'folder-shortcut') { if (clipboard.type === 'cut') { if (clipboard.sourceFolder && targetFolder && clipboard.sourceFolder !== targetFolder) { const shortcut = getShortcutById(id); if (shortcut) { moveShortcutToLocation(id, `folder:${targetFolder}`); } } } } }); if (clipboard.type === 'cut') { clipboard.items = []; clipboard.type = null; } clearSelection(); renderShortcuts(); renderFolders(); closeAllMenus();}function deleteSelection() { if (selectedItems.size === 0) { showMessage('Informaci√≥n', 'No hay elementos seleccionados para borrar.'); return; } showConfirm('Borrar elementos', `¬øEst√°s seguro de que quieres mover ${selectedItems.size} elemento(s) a la papelera?`, () => { saveUndoState(); selectedItems.forEach(itemKey => { const [type, id] = itemKey.split(':'); moveToTrash(id); }); clearSelection(); renderShortcuts(); renderFolders(); }); closeAllMenus();}function selectAll() { clearSelection(); const desktopShortcuts = document.querySelectorAll('#shortcuts-container .shortcut'); desktopShortcuts.forEach((shortcut) => { if (!shortcut.classList.contains('selected')) { const shortcutId = shortcut.getAttribute('data-id'); if (shortcutId) { toggleSelection(shortcut, shortcutId, 'shortcut'); } } }); const folderShortcuts = document.querySelectorAll('.folder-content .folder-shortcut'); folderShortcuts.forEach((shortcut) => { if (!shortcut.classList.contains('selected')) { const shortcutId = shortcut.getAttribute('data-id'); if (shortcutId) { toggleSelection(shortcut, shortcutId, 'folder-shortcut'); } } }); closeAllMenus();}function showMessage(title, message) { document.getElementById('message-title').textContent = title; document.getElementById('message-text').textContent = message; document.getElementById('message-modal').style.display = 'block';}function showConfirm(title, message, action) { document.getElementById('confirm-title').textContent = title; document.getElementById('confirm-message').textContent = message; pendingAction = action; document.getElementById('confirm-modal').style.display = 'block';}function executeConfirmedAction() { if (pendingAction) { pendingAction(); } closeModal('confirm-modal');}function openDiscoLocal() { const appWindow = { name: "Disco Local", type: 'web' }; const contentUrl = "http://winebox.cloud/accesories/wine.html?app=files&p=dock.exe"; createAppWindow(appWindow, contentUrl, 'web');}function openFrame(appName) { const appWindow = { name: appName, type: 'zip' }; const contentUrl = `http://winebox.cloud/accesories/wine.html?app=${appName}&p=${appName}.exe`; createAppWindow(appWindow, contentUrl, 'zip');}function showHelp() { let helpWindow = document.getElementById('help-window'); if (!helpWindow) { console.error("No se encontr√≥ la ventana de ayuda"); return; } document.getElementById('current-date').textContent = new Date().toLocaleDateString(); helpWindow.style.display = 'flex'; bringWindowToFront('help-window'); closeAllMenus(); console.log("Ventana de ayuda mostrada");}function setupDesktopDropZone() { const desktop = document.getElementById('shortcuts-container'); desktop.addEventListener('dragover', (e) => { e.preventDefault(); desktop.style.backgroundColor = 'rgba(0, 120, 212, 0.1)'; }); desktop.addEventListener('dragleave', (e) => { e.preventDefault(); desktop.style.backgroundColor = ''; }); desktop.addEventListener('drop', (e) => { e.preventDefault(); desktop.style.backgroundColor = ''; const data = e.dataTransfer.getData('text/plain'); const [itemType, itemId] = data.split(':'); if (itemType === 'shortcut') { moveShortcutToLocation(itemId, 'desktop'); saveAllData(); renderShortcuts(); renderFolders(); } else if (itemType === 'folder') { moveFolderToLocation(itemId, 'desktop'); saveAllData(); renderShortcuts(); renderFolders(); } });}function makeDraggable(element, folder) { const header = element.querySelector('.folder-header'); let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; header.onmousedown = dragMouseDown; function dragMouseDown(e) { e = e || window.event; e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; document.onmouseup = closeDragElement; document.onmousemove = elementDrag; } function elementDrag(e) { e = e || window.event; e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY; const newX = element.offsetLeft - pos1; const newY = element.offsetTop - pos2; element.style.left = newX + "px"; element.style.top = newY + "px"; if (folder && folder.position) { folder.position.x = newX; folder.position.y = newY; } } function closeDragElement() { document.onmouseup = null; document.onmousemove = null; if (folder && folder.id) { saveAllData(); } }}function makeResizable(element, folder) { const resizeHandle = document.createElement('div'); resizeHandle.style.width = '20px'; resizeHandle.style.height = '20px'; resizeHandle.style.background = 'transparent'; resizeHandle.style.position = 'absolute'; resizeHandle.style.right = '0'; resizeHandle.style.bottom = '0'; resizeHandle.style.cursor = 'se-resize'; element.appendChild(resizeHandle); resizeHandle.onmousedown = function(e) { e.preventDefault(); document.onmousemove = resizeElement; document.onmouseup = stopResize; }; function resizeElement(e) { const newWidth = Math.max(400, e.clientX - element.offsetLeft); const newHeight = Math.max(300, e.clientY - element.offsetTop); element.style.width = newWidth + 'px'; element.style.height = newHeight + 'px'; if (folder && folder.size) { folder.size.width = newWidth; folder.size.height = newHeight; } } function stopResize() { document.onmousemove = null; document.onmouseup = null; if (folder && folder.id) { saveAllData(); } }}function minimizeFolder(folderId) { minimizeWindow(folderId);}function closeFolder(folderId) { const folderWindow = document.getElementById(folderId); if (folderWindow) { folderWindow.style.display = 'none'; windowOriginalStates.delete(folderId); }}window.onload = function() { loadAllData(); loadSystemConfig(); renderShortcuts(); renderFolders(); setupDesktopDropZone(); updateClock(); clockInterval = setInterval(updateClock, 60000); setTimeout(updateActiveAppIcon, 500); document.addEventListener('mousedown', function(e) { setTimeout(updateActiveAppIcon, 100); }); const helpWindow = document.getElementById('help-window'); if (helpWindow) { makeDraggable(helpWindow); makeResizable(helpWindow); registerWindow(helpWindow); } const desktop = document.querySelector('.content'); if (desktop) { desktop.addEventListener('contextmenu', function(e) { e.preventDefault(); closeAllMenus(); const contextMenu = document.getElementById('desktop-context-menu'); contextMenu.style.display = 'block'; contextMenu.style.left = e.clientX + 'px'; contextMenu.style.top = e.clientY + 'px'; contextMenu.style.zIndex = '10002'; }); } document.addEventListener('click', function(e) { if (!e.target.closest('#desktop-context-menu')) { const contextMenu = document.getElementById('desktop-context-menu'); if (contextMenu) { contextMenu.style.display = 'none'; } } }); document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { const contextMenu = document.getElementById('desktop-context-menu'); if (contextMenu) { contextMenu.style.display = 'none'; } } }); setTimeout(function() { const newMenuItem = document.querySelector('#desktop-context-menu a[style*="position: relative"]'); if (newMenuItem) { newMenuItem.addEventListener('mouseenter', function() { const submenu = this.querySelector('.menu-content'); if (submenu) { submenu.style.display = 'block'; } }); newMenuItem.addEventListener('mouseleave', function() { const submenu = this.querySelector('.menu-content'); if (submenu) { setTimeout(() => { if (!submenu.matches(':hover')) { submenu.style.display = 'none'; } }, 100); } }); const submenu = newMenuItem.querySelector('.menu-content'); if (submenu) { submenu.addEventListener('mouseleave', function() { this.style.display = 'none'; }); } } }, 500); document.addEventListener('click', function(event) { if (!event.target.matches('.menu-item') && !event.target.closest('.shortcut') && !event.target.closest('.folder-shortcut')) { clearSelection(); } }); setInterval(cleanupGhostWindows, 30000);};function cleanupGhostWindows() { console.log("Ejecutando limpieza de ventanas fantasma..."); const initialAppCount = appWindows.length; appWindows = appWindows.filter(appWindow => { const element = document.getElementById(appWindow.id); if (element === null) { console.log("Eliminando ventana fantasma de appWindows:", appWindow.id); return false; } return true; }); const initialAllCount = allWindows.length; allWindows = allWindows.filter(window => { const element = document.getElementById(window.id); if (element === null) { console.log("Eliminando ventana fantasma de allWindows:", window.id); return false; } return true; }); updateRunningAppsList(); console.log(`Limpieza completada. appWindows: ${initialAppCount} -> ${appWindows.length}, allWindows: ${initialAllCount} -> ${allWindows.length}`);}document.addEventListener('click', function(event) { if (!event.target.matches('.menu-item') && !event.target.closest('.menu-item') && !event.target.matches('.clock-display') && !event.target.matches('.app-selector') && !event.target.closest('.app-selector')) { closeAllMenus(); }});function saveUndoState() { undoStack.push(JSON.parse(JSON.stringify(appData))); if (undoStack.length > 10) { undoStack.shift(); }}function toggleSelection(element, id, type) { const itemKey = `${type}:${id}`; if (selectedItems.has(itemKey)) { selectedItems.delete(itemKey); element.classList.remove('selected'); } else { selectedItems.add(itemKey); element.classList.add('selected'); }}function clearSelection() { selectedItems.forEach(itemKey => { const [type, id] = itemKey.split(':'); const elements = document.querySelectorAll(`.shortcut[data-id="${id}"], .folder-shortcut[data-id="${id}"]`); elements.forEach(el => el.classList.remove('selected')); }); selectedItems.clear();}function getCurrentFolderContext() { const activeFolderWindow = document.querySelector('.folder-window[style*="display: flex"]'); if (activeFolderWindow && activeFolderWindow.id !== 'trash-window' && activeFolderWindow.id !== 'help-window') { return activeFolderWindow.id; } return null;}function getShortcutById(id) { return appData.shortcuts.find(shortcut => shortcut.id === id);}function getFolderById(id) { return appData.folders.find(folder => folder.id === id);}function getAllItemsInLocation(location) { const items = []; const shortcuts = getShortcutsInLocation(location); shortcuts.forEach(shortcut => { items.push({ type: 'shortcut', id: shortcut.id, name: shortcut.name, icon: shortcut.icon, data: shortcut }); }); const folders = getFoldersInLocation(location); folders.forEach(folder => { items.push({ type: 'folder', id: folder.id, name: folder.name, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), data: folder }); }); return items;}function getShortcutsInLocation(location) { return appData.shortcuts.filter(shortcut => shortcut.location === location && !shortcut.isDiscoLocal && !shortcut.isTrash && !shortcut.isFolder && !isInTrash(shortcut.id) );}function getFoldersInLocation(location) { return appData.folders.filter(folder => { const folderShortcut = appData.shortcuts.find(s => s.isFolder && s.folderId === folder.id && s.location === location ); return folderShortcut !== undefined; });}function isInTrash(shortcutId) { return appData.trash.some(item => item.originalId === shortcutId);}function moveShortcutToLocation(shortcutId, targetLocation) { const shortcut = getShortcutById(shortcutId); if (!shortcut) return false; if (isInTrash(shortcutId)) { return false; } shortcut.location = targetLocation; saveAllData(); return true;}function moveFolderToLocation(folderId, targetLocation) { const folderShortcut = appData.shortcuts.find(s => s.isFolder && s.folderId === folderId ); if (!folderShortcut) return false; if (targetLocation.startsWith('folder:')) { const targetFolderId = targetLocation.split(':')[1]; if (targetFolderId === folderId) { showMessage('Error', 'No puedes mover una carpeta dentro de s√≠ misma.'); return false; } } saveUndoState(); folderShortcut.location = targetLocation; saveAllData(); return true;}function moveToTrash(itemId) { const shortcut = getShortcutById(itemId); const folder = getFolderById(itemId); if (!shortcut && !folder) { return; } if (shortcut && (shortcut.isDiscoLocal || shortcut.isTrash)) { return; } saveUndoState(); if (shortcut) { if (shortcut.isFolder) { moveFolderToTrash(shortcut.folderId); return; } appData.trash.push({ id: generateId(), originalId: itemId, name: shortcut.name, icon: shortcut.icon, type: shortcut.type, originalLocation: shortcut.location, deletedAt: new Date().toISOString(), itemType: 'shortcut' }); } else if (folder) { appData.trash.push({ id: generateId(), originalId: itemId, name: folder.name, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), type: 'folder', originalLocation: getFolderLocation(folder.id), deletedAt: new Date().toISOString(), itemType: 'folder' }); const folderShortcut = appData.shortcuts.find(s => s.isFolder && s.folderId === itemId); if (folderShortcut) { appData.shortcuts = appData.shortcuts.filter(s => s.id !== folderShortcut.id); } } updateTrashIcon(); saveAllData(); renderShortcuts(); renderFolders(); const itemName = shortcut ? shortcut.name : folder.name; showMessage('Elemento movido a la papelera', `"${itemName}" se ha movido a la papelera.`);}function moveFolderToTrash(folderId) { const folder = getFolderById(folderId); if (folder) { saveUndoState(); const folderItems = getAllItemsInLocation(`folder:${folderId}`); folderItems.forEach(item => { if (item.type === 'shortcut') { moveToTrash(item.id); } else if (item.type === 'folder') { moveFolderToTrash(item.id); } }); appData.trash.push({ id: generateId(), originalId: folderId, name: folder.name, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), type: 'folder', originalLocation: getFolderLocation(folderId), deletedAt: new Date().toISOString(), itemType: 'folder' }); appData.shortcuts = appData.shortcuts.filter(s => !(s.isFolder && s.folderId === folderId)); updateTrashIcon(); saveAllData(); renderShortcuts(); renderFolders(); showMessage('Carpeta movida a la papelera', `"${folder.name}" y su contenido se han movido a la papelera.`); }}function restoreFromTrash(trashIndex, targetFolder) { const trashItem = appData.trash[trashIndex]; if (!trashItem) return; saveUndoState(); let targetLocation; if (targetFolder) { targetLocation = `folder:${targetFolder.id}`; } else { targetLocation = trashItem.originalLocation || 'desktop'; } if (trashItem.itemType === 'shortcut') { moveShortcutToLocation(trashItem.originalId, targetLocation); } else if (trashItem.itemType === 'folder') { const folder = getFolderById(trashItem.originalId); if (folder) { appData.shortcuts.push({ id: generateId(), name: folder.name, icon: 'data:image/svg+xml;base64,' + btoa(folderIcon), isFolder: true, folderId: folder.id, created: folder.created, location: targetLocation, isFolderShortcut: true }); } } appData.trash.splice(trashIndex, 1); updateTrashIcon(); saveAllData(); renderShortcuts(); renderFolders(); showMessage('Elemento restaurado', `"${trashItem.name}" se ha restaurado.`); const trashWindow = document.getElementById('trash-window'); if (trashWindow) { if (appData.trash.length === 0) { closeFolder('trash-window'); } else { createTrashWindow(); } }}function getFolderLocation(folderId) { const folderShortcut = appData.shortcuts.find(s => s.isFolder && s.folderId === folderId); return folderShortcut ? folderShortcut.location : 'desktop';}function updateTrashIcon() { const trashShortcut = appData.shortcuts.find(s => s.isTrash); if (trashShortcut) { trashShortcut.icon = appData.trash.length > 0 ? 'data:image/svg+xml;base64,' + btoa(trashFullIcon) : 'data:image/svg+xml;base64,' + btoa(trashEmptyIcon); const trashElement = document.querySelector('.shortcut[data-id="' + trashShortcut.id + '"]'); if (trashElement) { const img = trashElement.querySelector('img'); if (img) { img.src = trashShortcut.icon; } } }}function setupTrashDropEvents(trashElement) { trashElement.addEventListener('dragover', (e) => { e.preventDefault(); trashElement.classList.add('trash-full'); }); trashElement.addEventListener('dragleave', (e) => { e.preventDefault(); trashElement.classList.remove('trash-full'); }); trashElement.addEventListener('drop', (e) => { e.preventDefault(); trashElement.classList.remove('trash-full'); const data = e.dataTransfer.getData('text/plain'); if (data.startsWith('shortcut:')) { const shortcutId = data.split(':')[1]; moveToTrash(shortcutId); } else if (data.startsWith('folder:')) { const folderId = data.split(':')[1]; moveFolderToTrash(folderId); } });}function setupFolderDragEvents(element, folderId) { element.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text/plain', 'folder:' + folderId); element.classList.add('dragging'); }); element.addEventListener('dragend', (e) => { element.classList.remove('dragging'); });}function setupShortcutDragEvents(element, shortcutId) { element.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text/plain', 'shortcut:' + shortcutId); element.classList.add('dragging'); }); element.addEventListener('dragend', (e) => { element.classList.remove('dragging'); });}function setupDropEvents(element, id) { element.addEventListener('dragover', (e) => { e.preventDefault(); }); element.addEventListener('drop', (e) => { e.preventDefault(); const data = e.dataTransfer.getData('text/plain'); if (data.startsWith('folder:')) { handleFolderDrop(data, id); } else if (data.startsWith('shortcut:')) { handleShortcutDrop(data, id); } else if (data.startsWith('trash:')) { handleTrashRestore(data, id); } });}function handleFolderDrop(data, targetId) { const folderId = data.split(':')[1]; if (draggedFolder !== null && draggedFolder !== targetId) { }}function handleShortcutDrop(data, targetIndex) { const [itemType, itemId] = data.split(':'); if (itemType === 'shortcut') { const targetFolder = appData.folders[targetIndex]; if (targetFolder) { moveShortcutToLocation(itemId, `folder:${targetFolder.id}`); } else { moveShortcutToLocation(itemId, 'desktop'); } } else if (itemType === 'folder') { const targetFolder = appData.folders[targetIndex]; if (targetFolder) { moveFolderToLocation(itemId, `folder:${targetFolder.id}`); } else { moveFolderToLocation(itemId, 'desktop'); } } renderShortcuts(); renderFolders();}function handleTrashRestore(data, targetId) { const trashIndex = parseInt(data.split(':')[1]); const targetFolder = getFolderById(targetId); restoreFromTrash(trashIndex, targetFolder);}function setupFolderContentEvents(folderWindow, folder) { const folderContent = document.getElementById(`${folder.id}-content`); const scrollArea = document.getElementById(`${folder.id}-scroll-area`); if (!folderContent || !scrollArea) return; const itemElements = folderContent.querySelectorAll('.folder-shortcut'); itemElements.forEach((element) => { const itemId = element.getAttribute('data-id'); const itemType = element.getAttribute('data-type'); element.addEventListener('click', function(e) { if (!e.ctrlKey && selectedItems.size === 0) { if (itemType === 'folder') { openFolder(itemId); } else { const shortcut = getShortcutById(itemId); if (shortcut) { if (shortcut.type === 'zip') { openFrame(shortcut.zip ? shortcut.zip.replace('.zip', '') : 'app'); } else if (shortcut.type === 'web') { openWebFrame(shortcut.url, shortcut); } else if (shortcut.type === 'html') { if (shortcut.fileObject) { openLocalHTML(shortcut.fileObject, shortcut); } else { showMessage('Error', 'El archivo HTML no est√° disponible.'); } } else if (shortcut.type === 'zip' || !shortcut.type) { openFrame(shortcut.name || 'app'); } } } } }); element.addEventListener('dragstart', (e) => { e.dataTransfer.setData('text/plain', `${itemType}:${itemId}`); element.classList.add('dragging'); }); element.addEventListener('dragend', (e) => { element.classList.remove('dragging'); }); element.addEventListener('click', (e) => { if (e.ctrlKey) { e.preventDefault(); toggleSelection(element, itemId, 'folder-shortcut'); } }); });}function setupFolderWindowDropZone(folderWindow, folder) { const scrollArea = folderWindow.querySelector('.folder-scroll-area'); if (!scrollArea) return; scrollArea.addEventListener('dragover', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = 'rgba(0, 120, 212, 0.1)'; }); scrollArea.addEventListener('dragleave', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = ''; }); scrollArea.addEventListener('drop', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = ''; const data = e.dataTransfer.getData('text/plain'); const [itemType, itemId] = data.split(':'); if (itemType === 'shortcut') { moveShortcutToLocation(itemId, `folder:${folder.id}`); saveAllData(); renderShortcuts(); refreshFolderContent(folder.id); } else if (itemType === 'folder') { moveFolderToLocation(itemId, `folder:${folder.id}`); saveAllData(); renderShortcuts(); refreshFolderContent(folder.id); } else if (data.startsWith('trash:')) { const trashIndex = parseInt(data.split(':')[1]); restoreFromTrash(trashIndex, folder); } });}function setupTrashWindowDropZone(trashWindow) { const scrollArea = trashWindow.querySelector('.folder-scroll-area'); if (!scrollArea) return; scrollArea.addEventListener('dragover', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = 'rgba(239, 83, 80, 0.1)'; }); scrollArea.addEventListener('dragleave', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = ''; }); scrollArea.addEventListener('drop', (e) => { e.preventDefault(); scrollArea.style.backgroundColor = ''; const data = e.dataTransfer.getData('text/plain'); if (data.startsWith('shortcut:')) { const shortcutId = data.split(':')[1]; moveToTrash(shortcutId); } else if (data.startsWith('folder:')) { const folderId = data.split(':')[1]; moveFolderToTrash(folderId); } });}function refreshFolderContent(folderId) { const folder = getFolderById(folderId); if (!folder) return; const folderWindow = document.getElementById(folderId); if (!folderWindow) return; const folderItems = getAllItemsInLocation(`folder:${folderId}`); const folderContent = document.getElementById(`${folderId}-content`); const folderHeader = folderWindow.querySelector('.folder-item-count'); if (folderContent && folderHeader) { folderHeader.textContent = `(${folderItems.length} elementos)`; let folderIconsHTML = ''; if (folderItems.length === 0) { folderIconsHTML = '<div class="folder-empty">Esta carpeta est√° vac√≠a</div>'; } else { folderItems.forEach(item => { const element = document.createElement('div'); element.className = item.type === 'folder' ? 'folder-shortcut folder-item' : 'folder-shortcut'; element.draggable = true; element.setAttribute('data-id', item.id); element.setAttribute('data-type', item.type); let content = ''; if (appData.settings.view === 'list') { content = `<div class="folder-shortcut-name">${item.name}</div>`; } else if (appData.settings.view === 'dates') { const date = new Date(item.data.created).toLocaleDateString(); content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div><div class="folder-shortcut-date">${date}</div> `; } else { content = ` <img src="${item.icon}" alt="${item.name}"><div class="folder-shortcut-name">${item.name}</div> `; } element.innerHTML = content; folderIconsHTML += element.outerHTML; }); } folderContent.innerHTML = folderIconsHTML; setTimeout(() => { setupFolderContentEvents(folderWindow, folder); }, 0); }}document.addEventListener('DOMContentLoaded', function() { document.addEventListener('dragstart', function(e) { if (e.target.classList.contains('folder-shortcut') && e.target.hasAttribute('data-trash-index')) { const trashIndex = parseInt(e.target.getAttribute('data-trash-index')); e.dataTransfer.setData('text/plain', 'trash:' + trashIndex); e.target.classList.add('dragging'); } }); document.addEventListener('dragend', function(e) { if (e.target.classList.contains('folder-shortcut')) { e.target.classList.remove('dragging'); } });});</script></body></html>