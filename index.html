<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WineBOX</title>
    <meta name="description" content="A Windows emulator and compiler.">
    <link rel="shortcut icon" href="src/icons/favicon.png" sizes="152x152">
    <link rel="apple-touch-icon" href="src/icons/favicon.png">
    <meta name="theme-color" content="#000"/>
    <link rel="manifest" href="manifest.json" />
    <meta property="og:type" content="website">
    <meta property="og:title" content="WineBOX">
    <meta property="og:url" content="/">
    <meta property="og:description" content="A Windows emu within browser.">
    <link rel="preload" href="src/wallpaper/img100.webp" as="image">
    <link rel="preload" href="src/wallpaper/img18.webp" as="image">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js');
            });
        }
    </script>
    <style>
        * {
            margin: 0;
            overflow: hidden;
        }

        .boot,
        .boot-animation {
            width: 100vw;
            height: 100vh;
            background-color: black;
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
            cursor: none;
        }

        .boot-animation {
            display: none;
            filter: brightness(1.34) contrast(1.06);
            background-color: white;
        }

        /* Configuración Panel */
        .settings-panel {
            position: fixed;
            top: 65%;
            left: 80%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 400px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 10001;
            overflow: hidden;
        }

        .settings-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f5f5f5;
        }

        .settings-content { display: flex; height: calc(100% - 60px); }
        .settings-sidebar { width: 180px; background: #f8f9fa; padding: 15px 0; }
        .settings-main { flex: 1; padding: 20px; overflow-y: auto; }

        .settings-option {
            padding: 10px 15px;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .settings-option.active {
            background: #e3f2fd;
            border-left-color: #0078d4;
            color: #0078d4;
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .wallpaper-item {
            aspect-ratio: 16/9;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .wallpaper-item.active {
            border-color: #0078d4;
        }

        .wallpaper-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .app-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .app-item {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-item.active {
            background: #e3f2fd;
            border-color: #0078d4;
        }

        .app-item img {
            width: 24px;
            height: 24px;
        }

        /* Estilos para opciones de clic */
        .click-options {
            margin-top: 20px;
        }

        .click-option {
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .click-option.active {
            background: #e3f2fd;
            border-color: #0078d4;
        }

        .click-option .radio {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .click-option.active .radio {
            border-color: #0078d4;
        }

        .click-option.active .radio::after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #0078d4;
        }

        /* Menú Contextual Mejorado */
        #context-menu {
            position: fixed;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            padding: 6px 0;
            min-width: 180px;
            z-index: 10000;
            display: none;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        #context-menu.visible { display: block; }
        
        #context-menu .item {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        #context-menu .item:hover { background: #e3f2fd; }
        #context-menu .separator {
            height: 1px;
            background: #e0e0e0;
            margin: 4px 0;
        }

        .desktopIcons figure.selected {
            background: rgba(32, 126, 220, 0.2);
            border-radius: 4px;
        }

        /* Ventanas de diálogo internas */
        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 20000;
            justify-content: center;
            align-items: center;
        }

        .dialog-overlay.active {
            display: flex;
        }

        .dialog-window {
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 400px;
            max-width: 90%;
            overflow: hidden;
        }

        .dialog-header {
            padding: 15px 20px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dialog-body {
            padding: 20px;
        }

        .dialog-footer {
            padding: 15px 20px;
            background: #f9f9f9;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dialog-button {
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .dialog-button.primary {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        .dialog-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 10px;
        }

        .dialog-message {
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
    <link rel="stylesheet" href="src/css/style.css">
</head>

<body>

    <!-- Power On Button -->
    <div class="powerOnBox">
        <div class="power-switch" id="powerOnBtn">
            <input type="checkbox" />
            <div class="button">
                <svg class="power-off">
                    <use xlink:href="#a" class="a" />
                    <use xlink:href="#b" class="b" />
                </svg>
                <svg class="power-on">
                    <use xlink:href="#a" class="a" />
                    <use xlink:href="#b" class="b" />
                </svg>
            </div>
        </div>
        <span style="color: lavender">Click to start the emulator</span>
        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol xmlns="http://www.w3.org/2000/svg" id="a" viewBox="0 0 150 150">
                <path d="M75 34v24" />
            </symbol>
            <symbol xmlns="http://www.w3.org/2000/svg" id="b" viewBox="0 0 150 150">
                <circle cx="75" cy="80" r="35" />
            </symbol>
        </svg>
    </div>

    <!-- Boot Elements -->
    <div class="boot">
        <img src="src/others/windowsLogo.svg" alt="Windows Logo" width="70" />
        <picture>
            <source srcset="src/others/bootLoader.svg">
            <img src="src/others/bootLoader.gif" alt="Windows boot loader" width="50" height="50">
        </picture>
    </div>
    <div class="boot-animation">
        <audio preload="auto" width="150" height="150" id="startupAudio">
            <source src="src/sounds/Windows Startup.webm" type="audio/webm">
            <source src="src/sounds/Windows Startup.mp3" type="audio/mp3">
        </audio>
    </div>

    <!-- Panel de Configuración -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>Configuration</h3>
            <img src="src/icons/cross.svg" alt="Close" onclick="closeSettings()" style="cursor: pointer; width: 16px; height: 16px;">
        </div>
        <div class="settings-content">
            <div class="settings-sidebar">
                <div class="settings-option active" onclick="showSettingsSection('personalization')">Personalization</div>
                <div class="settings-option" onclick="showSettingsSection('apps')">Applications</div>
                <div class="settings-option" onclick="showSettingsSection('desktop')">Desktop</div>
            </div>
            <div class="settings-main">
                <div id="personalization" class="settings-section">
                    <h4>Wallpaper</h4>
                    <div class="wallpaper-grid" id="wallpaperGrid"></div>
                </div>
                <div id="apps" class="settings-section" style="display: none;">
                    <h4>Start Menu Applications</h4>
                    <p>Select which apps appear in the Start Menu:</p>
                    <div class="app-list" id="appList"></div>
                </div>
                <div id="desktop" class="settings-section" style="display: none;">
                    <h4>Desktop Behavior</h4>
                    <p>Choose how icons open on the desktop:</p>
                    <div class="click-options">
                        <div class="click-option active" onclick="selectClickOption('single')">
                            <div class="radio"></div>
                            <div>
                                <strong>Single-click to open an item</strong>
                                <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                    Point to an item to select it
                                </div>
                            </div>
                        </div>
                        <div class="click-option" onclick="selectClickOption('double')">
                            <div class="radio"></div>
                            <div>
                                <strong>Double-click to open an item</strong>
                                <div style="font-size: 12px; color: #666; margin-top: 4px;">
                                    Single-click to select an item
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop -->
    <div class="desktop">
        <div class="desktopIcons" id="desktopIconsContainer">
            <!-- Los iconos se cargan dinámicamente -->
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start">
        <div class="pinned">
            <div class="start-top-elements">
                <span>Start</span>
                <button class="openAll" id="allapps">All apps <img src="src/icons/right.svg" alt="open all apps" class="smallRight"></button>
            </div>
            <div class="start-icons" id="startIconsContainer">
                <!-- Las apps se cargan dinámicamente según configuración -->
            </div>
        </div>
        <div class="others">
            <div class="user">
                <img src="src/icons/user.png" alt="Wine User icon">
                <span>Root</span>
            </div>
            <a href="src/redirects/shutdown/logoff.html"><img src="src/icons/shutdown.svg" alt="Shutdown icon" id="shutdown"></a>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <div class="center">
            <img src="src/icons/startButton.png" alt="Start icon" id="starticon" onclick="toggleStartMenu()">
            <img src="src/icons/taskView.svg" alt="Dock Store" onclick="executeProgram('dock')" id="dock">
            <img src="src/icons/fileExplorer.png" alt="Fileamanger icon" onclick="executeProgram('fileExplorer')" id="neticon">
            <img src="src/icons/edge.svg" alt="Internet Explorer icon" onclick="executeProgram('msedge')" id="neticon">  
            <img src="src/icons/store.png" alt="Winebox icon" onclick="executeProgram('store')" id="freedostore">
            <img src="src/icons/settings.svg" alt="Settings icon" onclick="openSettings()" id="settingsIcon">
        </div>
        <div class="right">
            <img src="src/icons/up.svg" alt="Up arrow" onclick="openSettings()">
            <!-- img src="src/icons/keyboard.svg" alt="Keyboard Meta Keys" id="keyboardOpener" onclick="toggleKeyboard()" -->
            <div class="time-date">
                <span></span>
                <span></span>
                <input type="checkbox" name="ncCheck" id="ncCheck" style="display: none;" checked>
            </div>
        </div>
    </div>

    <!-- Menú Contextual Mejorado -->
    <div id="context-menu">
        <div class="item" onclick="openSettings()">
            <img src="src/icons/settings.svg" alt="Configure" width="14" height="14">
            Configure Desktop
        </div>
        <div class="separator"></div>
        <div class="item" onclick="showRenameDialog()">
            <img src="src/icons/rename.png" alt="Rename" width="14" height="14">
            Rename
        </div>
        <div class="item" onclick="showDeleteDialog()">
            <img src="src/icons/delete.png" alt="Delete" width="14" height="14">
            Delete
        </div>
    </div>

    <!-- Ventanas de diálogo internas -->
    <div class="dialog-overlay" id="dialogOverlay">
        <div class="dialog-window" id="dialogWindow">
            <div class="dialog-header">
                <h3 id="dialogTitle">Dialog</h3>
                <img src="src/icons/cross.svg" alt="Close" onclick="closeDialog()" style="cursor: pointer; width: 16px; height: 16px;">
            </div>
            <div class="dialog-body" id="dialogBody">
                <!-- Contenido dinámico -->
            </div>
            <div class="dialog-footer" id="dialogFooter">
                <!-- Botones dinámicos -->
            </div>
        </div>
    </div>

    <!-- Resto del código original -->
    <link rel="stylesheet" href="src/css/actionCenter.css">
    <div class="notification-center">
        <div class="notifications">
        </div>
        <div class="calender">
            <div class="calender-top">
                <span>Calender</span>
                <img src="src/icons/down.svg" alt="Down Icon" width="20" height="20">
            </div>
        </div>
    </div>

    <div class="runDialog window">
        <div class="runHeader"> <img src="src/icons/runicon.png" alt="run icon" class="runIconSmall"> <span>Run</span>
            <div class="optionsWrapper"><img src="src/icons/cross.svg" alt="close" class="windowOptions windowCrosser"></div>
        </div>
        <div class="runBody">
            <div class="runBodyMessage"><img src="src/icons/runicon.png" alt="run Icon" id="runIconBody"><span>Type the name of the program, folder, document or internet resources, and windows will open it for you.</span></div>
            <label for="runInputField">Open: </label><input type="text" id="runInputField" autocomplete="off">
        </div>
        <div class="runFooter">
            <button class="disabledButton" id="runOkBtn">Ok</button>
            <button>Cancel</button>
            <button>Browse...</button>
        </div>
    </div>

    <div class="brightness-overlay"></div>

    <div class="imagesToBePreloaded" style="display: none;"></div>

    <!-- JavaScript Mejorado -->
    <script>
        // Sistema de configuración persistente
        const systemConfig = {
            wallpaper: 18,
            desktopIcons: [
                { id: 'deskcomp', name: 'This PC', icon: 'src/icons/Computer.png', program: 'progman' },
                { id: 'deskvscode', name: 'Flat Assembler', icon: 'src/icons/vscode.png', program: 'fasm' },
                { id: 'deskbrowser', name: 'Internet Explorer', icon: 'src/icons/edge.svg', program: 'msedge' }
            ],
            startMenuApps: [
                'fileExplorer', 'msedge', 'soffice', 'wallet', 'notepad', 'calendar',
                'dosbox', 'paint', 'npp', 'winehelp', 'todo', 'rec', 'winezip',
                'calc', 'sol', 'winemine', 'multimedia', 'clock'
            ],
            availableApps: {
                'fileExplorer': { name: 'Your Apps', icon: 'src/icons/fileExplorer.png' },
                'msedge': { name: 'Internet', icon: 'src/icons/edge.svg' },
                'soffice': { name: 'Office', icon: 'src/icons/office.svg' },
                'wallet': { name: 'Wallet', icon: 'src/icons/wallet.png' },
                'notepad': { name: 'Notepad', icon: 'src/icons/notepad.png' },
                'calendar': { name: 'Calendar', icon: 'src/icons/calender.svg' },
                'dosbox': { name: 'DOSBox', icon: 'src/icons/dosbox.png' },
                'paint': { name: 'Paint', icon: 'src/icons/photos.svg' },
                'npp': { name: 'Note', icon: 'src/icons/oneNote.svg' },
                'winehelp': { name: 'EXE2APK', icon: 'src/icons/yourPhone.svg' },
                'todo': { name: 'To Do', icon: 'src/icons/toDo.svg' },
                'rec': { name: 'Rec', icon: 'src/icons/movies.svg' },
                'winezip': { name: 'WineZIP', icon: 'src/icons/icons8-winrar.svg' },
                'calc': { name: 'Calc', icon: 'src/icons/calculator.svg' },
                'sol': { name: 'Sol', icon: 'src/icons/sol.png' },
                'winemine': { name: 'Winemine', icon: 'src/icons/winemine.png' },
                'multimedia': { name: 'Media', icon: 'src/icons/movies.svg' },
                'clock': { name: 'Clock', icon: 'src/icons/clock.svg' }
            },
            desktopClickMode: 'single' // 'single' or 'double'
        };

        // Variables globales
        let selectedDesktopIcon = null;
        let activeInputElement = null;
        let isShiftActive = false;
        let isCapsActive = false;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemConfig();
            initializeDesktop();
            initializeStartMenu();
            initializeKeyboard();
            setupEventListeners();
        });

        // Cargar configuración del sistema
        function loadSystemConfig() {
            const savedConfig = localStorage.getItem('wineboxConfig');
            if (savedConfig) {
                const parsedConfig = JSON.parse(savedConfig);
                Object.assign(systemConfig, parsedConfig);
            }
            applySystemConfig();
        }

        // Guardar configuración del sistema
        function saveSystemConfig() {
            localStorage.setItem('wineboxConfig', JSON.stringify(systemConfig));
        }

        // Aplicar configuración del sistema
        function applySystemConfig() {
            // Aplicar fondo de pantalla
            document.body.style.backgroundImage = `url(src/wallpaper/img${systemConfig.wallpaper}.webp)`;
            
            // Cargar iconos del escritorio
            loadDesktopIcons();
            
            // Cargar menú inicio
            loadStartMenu();
        }

        // Inicializar escritorio
        function initializeDesktop() {
            const desktop = document.querySelector('.desktopIcons');
            
            // Evento para menú contextual
            desktop.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                const icon = e.target.closest('figure');
                if (icon) {
                    showContextMenu(e, icon);
                }
            });

            // Cerrar menú contextual al hacer click fuera
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#context-menu')) {
                    hideContextMenu();
                }
            });
        }

        // Cargar iconos del escritorio
        function loadDesktopIcons() {
            const container = document.getElementById('desktopIconsContainer');
            container.innerHTML = systemConfig.desktopIcons.map(icon => `
                <figure id="${icon.id}" data-name="${icon.name}" data-program="${icon.program}">
                    <img src="${icon.icon}" alt="${icon.name}">
                    <figcaption class="iconName">${icon.name}</figcaption>
                </figure>
            `).join('');

            // Configurar eventos de los iconos según el modo de clic
            systemConfig.desktopIcons.forEach(icon => {
                const iconElement = document.getElementById(icon.id);
                if (iconElement) {
                    if (systemConfig.desktopClickMode === 'single') {
                        // Modo clic simple: un clic para abrir
                        iconElement.addEventListener('click', function(e) {
                            executeProgram(icon.program);
                            selectDesktopIcon(this);
                        });
                    } else {
                        // Modo doble clic: un clic para seleccionar, doble clic para abrir
                        iconElement.addEventListener('click', function(e) {
                            selectDesktopIcon(this);
                        });
                        
                        iconElement.addEventListener('dblclick', function(e) {
                            executeProgram(icon.program);
                        });
                    }

                    // Click largo para menú contextual
                    let longPressTimer;
                    iconElement.addEventListener('mousedown', function(e) {
                        longPressTimer = setTimeout(() => {
                            showContextMenu(e, this);
                        }, 500);
                    });

                    iconElement.addEventListener('mouseup', function() {
                        clearTimeout(longPressTimer);
                    });

                    iconElement.addEventListener('mouseleave', function() {
                        clearTimeout(longPressTimer);
                    });
                }
            });
        }

        // Cargar menú inicio
        function loadStartMenu() {
            const container = document.getElementById('startIconsContainer');
            const enabledApps = systemConfig.startMenuApps.filter(appId => 
                systemConfig.availableApps[appId]
            );

            container.innerHTML = enabledApps.map(appId => {
                const app = systemConfig.availableApps[appId];
                return `
                    <figure id="start${appId.charAt(0).toUpperCase() + appId.slice(1)}" onclick="executeProgram('${appId}')">
                        <img src="${app.icon}" alt="${app.name} icon">
                        <figcaption>${app.name}</figcaption>
                    </figure>
                `;
            }).join('');
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Botón de configuración
            document.getElementById('settingsIcon').addEventListener('click', openSettings);
        }

        // Funciones del sistema
        function selectDesktopIcon(icon) {
            document.querySelectorAll('.desktopIcons figure').forEach(i => {
                i.classList.remove('selected');
            });
            icon.classList.add('selected');
            selectedDesktopIcon = icon;
        }

        function showContextMenu(e, icon) {
            selectedDesktopIcon = icon;
            const contextMenu = document.getElementById('context-menu');
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            contextMenu.classList.add('visible');
        }

        function hideContextMenu() {
            document.getElementById('context-menu').classList.remove('visible');
        }

        // Funciones de configuración
        function openSettings() {
            document.getElementById('settingsPanel').style.display = 'block';
            loadSettingsContent();
        }

        function closeSettings() {
            document.getElementById('settingsPanel').style.display = 'none';
        }

        function showSettingsSection(section) {
            // Ocultar todas las secciones
            document.querySelectorAll('.settings-section').forEach(sec => {
                sec.style.display = 'none';
            });
            // Quitar active de todas las opciones
            document.querySelectorAll('.settings-option').forEach(opt => {
                opt.classList.remove('active');
            });
            // Mostrar sección seleccionada
            document.getElementById(section).style.display = 'block';
            // Activar opción seleccionada
            event.target.classList.add('active');
        }

        function loadSettingsContent() {
            // Cargar fondos de pantalla
            const wallpapers = [18, 28, 29, 30, 31, 32, 33, 34, 35];
            document.getElementById('wallpaperGrid').innerHTML = wallpapers.map(wp => `
                <div class="wallpaper-item ${wp === systemConfig.wallpaper ? 'active' : ''}">
                    <img src="src/wallpaper/img${wp}.webp" onclick="selectWallpaper(${wp})">
                </div>
            `).join('');

            // Cargar lista de aplicaciones
            const appList = document.getElementById('appList');
            appList.innerHTML = Object.keys(systemConfig.availableApps).map(appId => {
                const app = systemConfig.availableApps[appId];
                const isEnabled = systemConfig.startMenuApps.includes(appId);
                return `
                    <div class="app-item ${isEnabled ? 'active' : ''}" onclick="toggleStartMenuApp('${appId}')">
                        <img src="${app.icon}" alt="${app.name}">
                        <span>${app.name}</span>
                    </div>
                `;
            }).join('');

            // Cargar opciones de clic del escritorio
            loadDesktopClickOptions();
        }

        function loadDesktopClickOptions() {
            const singleClickOption = document.querySelector('#desktop .click-options .click-option:nth-child(1)');
            const doubleClickOption = document.querySelector('#desktop .click-options .click-option:nth-child(2)');
            
            // Remover clases active
            singleClickOption.classList.remove('active');
            doubleClickOption.classList.remove('active');
            
            // Aplicar active según configuración
            if (systemConfig.desktopClickMode === 'single') {
                singleClickOption.classList.add('active');
            } else {
                doubleClickOption.classList.add('active');
            }
        }

        function selectClickOption(mode) {
            systemConfig.desktopClickMode = mode;
            saveSystemConfig();
            loadDesktopClickOptions();
            // Recargar iconos del escritorio para aplicar el nuevo comportamiento
            loadDesktopIcons();
        }

        function selectWallpaper(wallpaperId) {
            systemConfig.wallpaper = wallpaperId;
            document.body.style.backgroundImage = `url(src/wallpaper/img${wallpaperId}.webp)`;
            saveSystemConfig();
            // Actualizar vista
            loadSettingsContent();
        }

        function toggleStartMenuApp(appId) {
            const index = systemConfig.startMenuApps.indexOf(appId);
            if (index > -1) {
                systemConfig.startMenuApps.splice(index, 1);
            } else {
                systemConfig.startMenuApps.push(appId);
            }
            saveSystemConfig();
            loadStartMenu();
            loadSettingsContent();
        }

        // Funciones del menú contextual del escritorio
        function openDesktopProperties() {
            if (selectedDesktopIcon) {
                // Aquí podrías mostrar un diálogo de propiedades
                console.log('Properties of:', selectedDesktopIcon.dataset.name);
            }
            hideContextMenu();
        }

        // Sistema de diálogos internos
        function showDialog(title, bodyHTML, buttons) {
            const overlay = document.getElementById('dialogOverlay');
            const dialogTitle = document.getElementById('dialogTitle');
            const dialogBody = document.getElementById('dialogBody');
            const dialogFooter = document.getElementById('dialogFooter');
            
            dialogTitle.textContent = title;
            dialogBody.innerHTML = bodyHTML;
            
            // Configurar botones
            dialogFooter.innerHTML = '';
            buttons.forEach(button => {
                const btn = document.createElement('button');
                btn.textContent = button.text;
                btn.className = button.primary ? 'dialog-button primary' : 'dialog-button';
                btn.onclick = button.action;
                dialogFooter.appendChild(btn);
            });
            
            overlay.classList.add('active');
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('active');
        }

        function showRenameDialog() {
            if (!selectedDesktopIcon) return;
            
            const currentName = selectedDesktopIcon.dataset.name;
            const bodyHTML = `
                <div class="dialog-message">Enter new name for this icon:</div>
                <input type="text" class="dialog-input" id="renameInput" value="${currentName}" autofocus>
            `;
            
            const buttons = [
                {
                    text: 'Cancel',
                    action: function() {
                        closeDialog();
                        hideContextMenu();
                    }
                },
                {
                    text: 'OK',
                    primary: true,
                    action: function() {
                        const newName = document.getElementById('renameInput').value.trim();
                        if (newName) {
                            renameDesktopIcon(newName);
                        }
                        closeDialog();
                        hideContextMenu();
                    }
                }
            ];
            
            showDialog('Rename Icon', bodyHTML, buttons);
            
            // Enfocar y seleccionar texto
            setTimeout(() => {
                const input = document.getElementById('renameInput');
                input.focus();
                input.select();
            }, 100);
        }

        function showDeleteDialog() {
            if (!selectedDesktopIcon) return;
            
            const iconName = selectedDesktopIcon.dataset.name;
            const bodyHTML = `
                <div class="dialog-message">Are you sure you want to delete "${iconName}"?</div>
            `;
            
            const buttons = [
                {
                    text: 'Cancel',
                    action: function() {
                        closeDialog();
                        hideContextMenu();
                    }
                },
                {
                    text: 'Delete',
                    primary: true,
                    action: function() {
                        deleteDesktopIcon();
                        closeDialog();
                        hideContextMenu();
                    }
                }
            ];
            
            showDialog('Delete Icon', bodyHTML, buttons);
        }

        function renameDesktopIcon(newName) {
            if (selectedDesktopIcon) {
                selectedDesktopIcon.dataset.name = newName;
                selectedDesktopIcon.querySelector('.iconName').textContent = newName;
                
                // Actualizar en configuración
                const iconId = selectedDesktopIcon.id;
                const iconConfig = systemConfig.desktopIcons.find(icon => icon.id === iconId);
                if (iconConfig) {
                    iconConfig.name = newName;
                    saveSystemConfig();
                }
            }
        }

        function deleteDesktopIcon() {
            if (selectedDesktopIcon) {
                const iconId = selectedDesktopIcon.id;
                
                // Remover de la configuración
                systemConfig.desktopIcons = systemConfig.desktopIcons.filter(icon => icon.id !== iconId);
                saveSystemConfig();
                
                // Remover del DOM
                selectedDesktopIcon.remove();
                selectedDesktopIcon = null;
            }
        }

        // Función executeProgram existente (se mantiene igual)
        function executeProgram(program) {
            // Tu lógica existente para ejecutar programas
            console.log('Executing program:', program);
        }

        // Función toggleStartMenu existente
        function toggleStartMenu() {
            // Tu lógica existente para el menú inicio
        }

        // Mantener funciones originales para compatibilidad
        function OCBROWSER() {
            // Tu función original
        }
    </script>

    <!-- Scripts originales -->
    <script src="src/js/boot.js"></script>
    <script src="src/js/start.js"></script>
    <script src="src/js/desktop.js"></script>
    <script src="src/js/window.js"></script>
    <script src="src/js/run.js"></script>
    <script src="src/js/keyboard.js"></script>
    <script src="src/js/taskbar.js"></script>
    <script src="src/js/notification.js"></script>
    <link rel="stylesheet" type="text/css" href="src/css/webapps.css">
    <link rel="stylesheet" type="text/css" href="src/css/animations.css">
    <script src="src/js/tutorial.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css">
    <script src="src/js/tippy.js"></script>
    <script src="src/js/offline.js"></script>
    <script src="src/js/power.js"></script>
</body>

</html>